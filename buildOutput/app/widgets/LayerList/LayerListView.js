//>>built
require({cache:{"url:widgets/LayerList/LayerListView.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"layer-list-operations" data-dojo-attach-point\x3d"layerListOperations"\x3e\r\n    \x3c!--div class\x3d"setting-image jimu-icon jimu-icon-setting jimu-state-disabled"\x3e\x3c/div--\x3e\r\n  \x3c/div\x3e\r\n  \x3ctable class\x3d"layer-list-table"\x3e\r\n    \x3ctbody class\x3d"layers-list-body" data-dojo-attach-point\x3d"layerListTable"\x3e\r\n    \t\x3ctr class\x3d"hrClass" \x3e\r\n\t\t   \x3ctd class\x3d"" colspan\x3d"4"\x3e\r\n\t\t\t\t\x3chr/\x3e\r\n\t\t   \x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n    \t\x3ctr class\x3d"hrClassNonGraphic" \x3e\r\n\t\t   \x3ctd class\x3d"" colspan\x3d"4"\x3e\r\n\t\t   \x3c/td\x3e\r\n\t\t\x3c/tr\x3e\t\t\r\n    \x3c/tbody\x3e\r\n    \x3ctbody class\x3d"layers-list-body" data-dojo-attach-point\x3d"tableListTable"\x3e\x3c/tbody\x3e       \r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n'}});
define("dijit/_WidgetBase dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query jimu/dijit/CheckBox jimu/PanelManager jimu/dijit/DropMenu jimu/dijit/LoadingShelter ./PopupMenu dijit/_TemplatedMixin dojo/text!./LayerListView.html dojo/dom-attr dojo/dom-class dojo/dom-style ./NlsStrings".split(" "),function(v,w,l,k,g,q,h,x,F,y,z,A,B,C,G,m,n,D){return w([v,B],{templateString:C,_currentSelectedLayerRowNode:null,operationsDropMenu:null,_layerNodeHandles:null,_layerDomNodeStorage:null,
postMixInProperties:function(){this.inherited(arguments);this.nls=D.value;this._layerDomNodeStorage={}},postCreate:function(){this.refresh();this._initOperations()},refresh:function(){this._removeLayerNodes();k.forEach(this.operLayerInfos.getLayerInfoArray(),function(a){var b=h("[class~\x3d'hrClass']",this.domNode)[0],c=h("[class~\x3d'hrClassNonGraphic']",this.domNode)[0];a.layerObject.type&&"FEATURE LAYER"==a.layerObject.type.toUpperCase()||a.layerObject.url.toUpperCase().indexOf("FEATURESERVER")&&
a.layerObject.url.toUpperCase().indexOf("ARCGIS.COM")?this.drawListNode(a,0,b,"before"):this.drawListNode(a,0,c,"before")},this);this.config.showBasemap&&k.forEach(this.operLayerInfos.getBasemapLayerInfoArray(),function(a){this.drawListNode(a,0,this.layerListTable)},this);k.forEach(this.operLayerInfos.getTableInfoArray(),function(a){this.drawListNode(a,0,this.tableListTable)},this)},drawListNode:function(a,b,c,e){var d;!this.isLayerHiddenInWidget(a)&&this.layerFilter.isValidLayerInfo(a)&&(d=this._layerDomNodeStorage[a.getObjectId()],
(a.isRootLayer()||a.isTable)&&d?(g.place(d.layerTrNode,c,e),g.place(d.layerContentTrNode,c,e)):0===a.newSubLayers.length?(d=this.addLayerNode(a,b,c,e),this.config.showLegend?this.addLegendNode(a,b,d.subNode):(a=h(".showLegend-div",d.layerTrNode)[0])&&m.add(a,"hidden")):(d=this.addLayerNode(a,b,c,e),k.forEach(a.newSubLayers,l.hitch(this,function(a,b){this.drawListNode(b,a+1,d.subNode)},b))))},addLayerNode:function(a,b,c,e){var d,f,k,h,m,r,p,t=a.getRootLayerInfo();if(a.isRootLayer()||a.isTable)this._layerDomNodeStorage[a.getObjectId()]=
{layerTrNode:null,layerContentTrNode:null,layerNodeEventHandles:[],layerNodeReferredDijits:[]};d=g.create("tr",{"class":"jimu-widget-row layer-row  layer-tr-node-"+a.id,layerTrNodeId:a.id});g.place(d,c,e);f=g.create("td",{"class":"col col1"},d);for(p=0;p<b;p++)g.create("div",{"class":"begin-blank-div jimu-float-leading",innerHTML:""},f);p=g.create("div",{"class":"showLegend-div jimu-float-leading",imageShowLegendDivId:a.id},f);k=g.create("div",{"class":"div-select jimu-float-leading"},f);layerId=
a.id;0<=layerId.indexOf(window.layerIdPrefix)?h=layerId.replace(window.layerIdPrefix,""):0<=layerId.indexOf(window.layerIdPBSPrefix)&&(h=layerId.replace(window.layerIdPBSPrefix,""));h=new x({checked:a.isVisible()||window.allLayersTurnedOn[h],"class":"visible-checkbox-"+a.id});g.place(h.domNode,k);m=g.create("div",{"class":"noLegend-div jimu-float-leading"},f);var u;u=a.isTable?"images/table.png":a.isBasemap()?"images/basemap.png":"images/noLegend.png";g.create("img",{"class":"noLegend-image",src:this.layerListWidget.folderUrl+
u,alt:"l"},m);if(a.isTiled||a.isTable||a.isBasemap())n.set(p,"display","none"),n.set(k,"display","none"),n.set(m,"display","block");n.set(f,"width",12*b+40+"px");scaleLabel=g.create("td",{"class":"col col15"},d);scaleObject="";a.layerObject.eaScale&&(scaleTitle="Community Dataset","NATIONAL"==a.layerObject.eaScale&&(scaleTitle="National Dataset"),scale=a.layerObject.eaScale,scaleImage=g.create("div",{title:scaleTitle,"class":"icon_style "+scale},scaleLabel));f=a.title;b=g.create("div",{"class":"col col2"},
d);k="";try{r=a.id.replace(window.layerIdPrefix,"").replace(window.layerIdPBSPrefix,""),a.isInScale()||null!=window.hashIDtoTileURL[r]||(k="grayed-title")}catch(E){console.warn(E.message)}g.create("td",{id:window.layerTitlePrefix+a.id,innerHTML:f,"class":"layer-title-div-"+a.id+" div-content jimu-float-leading "+k},b);f=g.create("td",{"class":"col col3"},d);r=this.hasContentMenu()?"display: block":"display: none";r=g.create("div",{"class":"layers-list-popupMenu-div",style:r},f);f=g.create("tr",{"class":"",
layerContentTrNodeId:a.id});g.place(f,c,e);c=g.create("td",{"class":"",colspan:"3"},f);c=g.create("table",{"class":"layer-sub-node",subNodeId:a.id},c);e=this.own(q(b,"click",l.hitch(this,this._onRowTrClick,a,p,d,c)));this._storeLayerNodeEventHandle(t,e[0]);e=this.own(q(p,"click",l.hitch(this,this._onRowTrClick,a,p,d,c)));this._storeLayerNodeEventHandle(t,e[0]);e=this.own(q(h.domNode,"click",l.hitch(this,this._onCkSelectNodeClick,a,h)));this._storeLayerNodeEventHandle(t,e[0]);e=this.own(q(r,"click",
l.hitch(this,this._onPopupMenuClick,a,r,d)));this._storeLayerNodeEventHandle(t,e[0]);if(a.isRootLayer()||a.isTable)this._layerDomNodeStorage[a.getObjectId()].layerTrNode=d,this._layerDomNodeStorage[a.getObjectId()].layerContentTrNode=f;this.layerFilter.isExpanded(a)&&this._foldOrUnfoldLayer(a,!1,p,c);return{layerTrNode:d,subNode:c}},hasContentMenu:function(){var a=!1,b;if(this.config.contextMenu)for(b in this.config.contextMenu)this.config.contextMenu.hasOwnProperty(b)&&"function"!==typeof this.config.contextMenu[b]&&
(a=a||this.config.contextMenu[b]);else a=!0;return a},addLegendNode:function(a,b,c){c=g.create("tr",{"class":"legend-node-tr"},c);c=g.create("td",{"class":"legend-node-td"},c);try{var e=a.createLegendsNode();n.set(e,"font-size",12*(b+1)+"px");g.place(e,c)}catch(d){console.error(d)}},_storeLayerNodeEventHandle:function(a,b){(a=this._layerDomNodeStorage[a.getObjectId()])&&a.layerNodeEventHandles.push(b)},_storeLayerNodeDijit:function(a,b){(a=this._layerDomNodeStorage[a.getObjectId()])&&a.layerNodeReferredDijits.push(b)},
_clearLayerDomNodeStorage:function(){var a=this.operLayerInfos.getLayerInfoArray(),b=this.operLayerInfos.getTableInfoArray(),a=a.concat(b),c;for(c in this._layerDomNodeStorage)this._layerDomNodeStorage.hasOwnProperty(c)&&"function"!==typeof this._layerDomNodeStorage[c]&&(b=k.some(a,function(a){if(a.getObjectId().toString()===c)return!0},this),b||(k.forEach(this._layerDomNodeStorage[c].layerNodeEventHandles,function(a){a.remove()},this),k.forEach(this._layerDomNodeStorage[c].layerNodeReferredDijits,
function(a){a.destroy()},this),g.destroy(this._layerDomNodeStorage[c].layerTrNode),g.destroy(this._layerDomNodeStorage[c].layerContentTrNode),delete this._layerDomNodeStorage[c]))},_removeLayerNodes:function(){var a,b;this._clearLayerDomNodeStorage();for(var c in this._layerDomNodeStorage)this._layerDomNodeStorage.hasOwnProperty(c)&&"function"!==typeof this._layerDomNodeStorage[c]&&(a=this._layerDomNodeStorage[c],a.layerContentTrNode&&a.layerTrNode&&((b=a.layerTrNode.parentNode)&&b.removeChild(a.layerTrNode),
(b=a.layerContentTrNode.parentNode)&&b.removeChild(a.layerContentTrNode)))},_foldSwitch:function(a,b,c){return"none"===n.get(c,"display")?this._foldOrUnfoldLayer(a,!1,b,c):this._foldOrUnfoldLayer(a,!0,b,c)},_foldOrUnfoldLayer:function(a,b,c,e){var d=d?c:h("div[imageShowLegendDivId\x3d'"+a.id+"']",this.layerListTable)[0],f=f?e:h("table[subNodeId\x3d'"+a.id+"']",this.layerListTable)[0];c=null;d&&f&&(b?(n.set(f,"display","none"),m.remove(d,"unfold"),c=!0):(n.set(f,"display","table"),m.add(d,"unfold"),
c=!1,a.isLeaf()&&(b=h(".legends-div",f)[0],d=h(".legends-loading-img",b)[0],b&&d&&a.drawLegends(b,this.layerListWidget.appConfig.portalUrl))));return c},redrawLegends:function(a){var b=h("div[legendsDivId\x3d'"+a.id+"']",this.layerListTable)[0];b&&(b._legendDijit&&b._legendDijit.destroy&&b._legendDijit.destroy(),a.drawLegends(b,this.layerListWidget.appConfig.portalUrl))},_foldOrUnfoldLayers:function(a,b){k.forEach(a,function(a){this._foldOrUnfoldLayer(a,b)},this)},_onCkSelectNodeClick:function(a,
b,c){c.ctrlKey||c.metaKey?a.isRootLayer()?this.turnAllRootLayers(b.checked):this.turnAllSameLevelLayers(a,b.checked):(this.layerListWidget._denyLayerInfosIsVisibleChangedResponseOneTime=!0,eaId="",layerId=a.id,0<=layerId.indexOf(window.layerIdPrefix)?eaId=layerId.replace(window.layerIdPrefix,""):0<=layerId.indexOf(window.layerIdPBSPrefix)&&(eaId=layerId.replace(window.layerIdPBSPrefix,"")),lyrTiled=a.map.getLayer(window.layerIdTiledPrefix+eaId),b.checked?lyrTiled&&null==window.hashRenderer[eaId]&&
lyrTiled.setVisibility(!0):lyrTiled&&lyrTiled.setVisibility(!1),a.setTopLayerVisible(b.checked));c.stopPropagation()},_onPopupMenuClick:function(a,b,c,e){var d=a.getRootLayerInfo(),f=b.popupMenu;f||(f=(new A({_layerInfo:a,box:this.layerListWidget.domNode.parentNode,popupMenuNode:b,layerListWidget:this.layerListWidget,_config:this.config})).placeAt(b),b.popupMenu=f,this._storeLayerNodeDijit(d,f),a=this.own(q(f,"onMenuClick",l.hitch(this,this._onPopupMenuItemClick,a,f))),this._storeLayerNodeEventHandle(d,
a[0]));this._changeSelectedLayerRow(c);f&&"opened"===f.state?f.closeDropMenu():(this._hideCurrentPopupMenu(),f&&(this.currentPopupMenu=f,f.openDropMenu()));this.operationsDropMenu&&"opened"===this.operationsDropMenu.state&&this.operationsDropMenu.closeDropMenu();e.stopPropagation()},_hideCurrentPopupMenu:function(){this.currentPopupMenu&&"opened"===this.currentPopupMenu.state&&this.currentPopupMenu.closeDropMenu()},_onLayerListWidgetPaneClick:function(){this.operationsDropMenu&&this.operationsDropMenu.closeDropMenu()},
_onRowTrClick:function(a,b,c,e,d){this._changeSelectedLayerRow(c);b=this._foldSwitch(a,b,e);if(d.ctrlKey||d.metaKey)a.isRootLayer()?this.foldOrUnfoldAllRootLayers(b):this.foldOrUnfoldSameLevelLayers(a,b)},_changeSelectedLayerRow:function(a){this._currentSelectedLayerRowNode&&this._currentSelectedLayerRowNode===a||(this._currentSelectedLayerRowNode&&m.remove(this._currentSelectedLayerRowNode,"jimu-widget-row-selected"),m.add(a,"jimu-widget-row-selected"),this._currentSelectedLayerRowNode=a)},_onPopupMenuItemClick:function(a,
b,c,e){e={itemKey:c.key,extraData:e,layerListWidget:this.layerListWidget,layerListView:this};"transparency"===c.key?"none"===n.get(b.transparencyDiv,"display")?b.showTransNode(a.getOpacity()):b.hideTransNode():"setVisibilityRange"===c.key?"none"===n.get(b.setVisibilityRangeNode,"display")?b.showSetVisibilityRangeNode(a):b.hideSetVisibilityRangeNode():(a=b.popupMenuInfo.onPopupMenuClick(e),a.closeMenu&&b.closeDropMenu())},_exchangeLayerTrNode:function(a,b){a=h("tr[layerTrNodeId\x3d'"+a.id+"']",this.layerListTable)[0];
var c=h("tr[layerTrNodeId\x3d'"+b.id+"']",this.layerListTable)[0];b=h("tr[layerContentTrNodeId\x3d'"+b.id+"']",this.layerListTable)[0];a&&c&&b&&(this.layerListTable.removeChild(c),this.layerListTable.insertBefore(c,a),this.layerListTable.removeChild(b),this.layerListTable.insertBefore(b,a))},_getMovedSteps:function(a,b){var c=1,e,d=this.operLayerInfos.getLayerInfoArray();k.forEach(d,function(b,c){a.id===b.id&&(e=c)},this);if("moveup"===b)for(;!d[e].isFirst&&!(e--,!this.isLayerHiddenInWidget(d[e])&&
this.layerFilter.isValidLayerInfo(d[e])||d[e].isFirst);)c++;else for(;!d[e].isLast&&!(e++,!this.isLayerHiddenInWidget(d[e])&&this.layerFilter.isValidLayerInfo(d[e])||d[e].isLast);)c++;return c},_initOperations:function(){this.operationsDropMenu=(new y({items:[{key:"turnAllLayersOn",label:this.nls.turnAllLayersOn},{key:"turnAllLayersOff",label:this.nls.turnAllLayersOff},{key:"separator"},{key:"expandAllLayers",label:this.nls.expandAllLayers},{key:"collapseAlllayers",label:this.nls.collapseAlllayers},
{key:"removeAllLayers",label:this.nls.removeAllLayers}],box:this.layerListWidget.domNode.parentNode})).placeAt(this.layerListOperations);var a=h("div.jimu-dropmenu \x3e div:first-child",this.layerListOperations)[0];a&&(m.remove(a,["jimu-icon-btn","popup-menu-button"]),m.add(a,["feature-action","icon-operation"]));this.operationsDropMenu.btnNode&&this.own(q(this.operationsDropMenu.btnNode,"click",l.hitch(this,this._onLayerListOperationsClick)));this.own(q(this.operationsDropMenu,"onMenuClick",l.hitch(this,
this._onOperationsMenuItemClick)));this.operationsDropMenuLoading=(new z({hidden:!0})).placeAt(this.operationsDropMenu.domNode)},_onLayerListOperationsClick:function(){this._hideCurrentPopupMenu()},_onOperationsMenuItemClick:function(a){switch(a.key){case "turnAllLayersOn":this.turnAllRootLayers(!0);break;case "turnAllLayersOff":this.turnAllRootLayers(!1);break;case "expandAllLayers":this.foldOrUnfoldAllLayers(!1);break;case "collapseAlllayers":this.foldOrUnfoldAllLayers(!0);break;case "removeAllLayers":document.getElementById("butRemoveAllLayers").click()}},
isFirstDisplayedLayerInfo:function(a){var b,c;a.isFirst||!a.isRootLayer()||a.isBasemap()?b=!0:(b=this._getMovedSteps(a,"moveup"),c=this.operLayerInfos.getLayerInfoArray(),a=this.operLayerInfos._getTopLayerInfoIndexById(a.id),b=this.isLayerHiddenInWidget(c[a-b])||!this.layerFilter.isValidLayerInfo(c[a-b])?!0:!1);return b},isLastDisplayedLayerInfo:function(a){var b,c;a.isLast||!a.isRootLayer()||a.isBasemap()?b=!0:(b=this._getMovedSteps(a,"movedown"),c=this.operLayerInfos.getLayerInfoArray(),a=this.operLayerInfos._getTopLayerInfoIndexById(a.id),
b=this.isLayerHiddenInWidget(c[a+b])||!this.layerFilter.isValidLayerInfo(c[a+b])?!0:!1);return b},moveUpLayer:function(a){var b=this._getMovedSteps(a,"moveup");this.layerListWidget._denyLayerInfosReorderResponseOneTime=!0;(b=this.operLayerInfos.moveUpLayer(a,b))&&this._exchangeLayerTrNode(b,a)},moveDownLayer:function(a){var b=this._getMovedSteps(a,"movedown");this.layerListWidget._denyLayerInfosReorderResponseOneTime=!0;(b=this.operLayerInfos.moveDownLayer(a,b))&&this._exchangeLayerTrNode(a,b)},isLayerHiddenInWidget:function(a){var b=
!1,c=a;if(a&&this.config.layerOptions&&void 0!==this.config.layerOptions[a.id])for(;c&&!(b=b||!this.config.layerOptions[c.id].display);)c=c.parentLayerInfo;else b=!1;return b},turnAllRootLayers:function(a){var b=this.operLayerInfos.getLayerInfoArray();k.forEach(b,function(b){this.isLayerHiddenInWidget(b)||(b.setTopLayerVisible(a),eaId="",layerId=b.id,0<=layerId.indexOf(window.layerIdPrefix)?eaId=layerId.replace(window.layerIdPrefix,""):0<=layerId.indexOf(window.layerIdPBSPrefix)&&(eaId=layerId.replace(window.layerIdPBSPrefix,
"")),window.allLayersTurnedOn[eaId]=a,lyrTiled=b.map.getLayer(window.layerIdTiledPrefix+eaId),a?lyrTiled&&null==window.hashRenderer[eaId]&&lyrTiled.setVisibility(!0):lyrTiled&&lyrTiled.setVisibility(!1))},this)},turnAllSameLevelLayers:function(a,b){var c={},e=a.getRootLayerInfo();e.traversal(l.hitch(this,function(d){d.parentLayerInfo&&d.parentLayerInfo.id===a.parentLayerInfo.id&&!this.isLayerHiddenInWidget(d)?c[d.id]={visible:b}:c[d.id]={visible:d.isVisible()}}));e.resetLayerObjectVisibility(c)},
foldOrUnfoldAllRootLayers:function(a){var b=k.filter(this.operLayerInfos.getLayerInfoArray(),function(a){return!this.isLayerHiddenInWidget(a)},this);this._foldOrUnfoldLayers(b,a)},foldOrUnfoldSameLevelLayers:function(a,b){a.parentLayerInfo&&(a=k.filter(a.parentLayerInfo.getSubLayers(),function(a){return!this.isLayerHiddenInWidget(a)},this),this._foldOrUnfoldLayers(a,b))},foldOrUnfoldAllLayers:function(a){var b=[],c=[];this.operationsDropMenuLoading.show();this.operLayerInfos.traversal(l.hitch(this,
function(a){this.isLayerHiddenInWidget(a)||(a.isRootLayer()?c.push(a):b.push(a))}));var b=c.concat(b),e=0,d=b.length;setTimeout(l.hitch(this,function(){if(e<d){var c=b.slice(e,e+50);this._foldOrUnfoldLayers(c,a);e+=50;setTimeout(l.hitch(this,arguments.callee),60)}else this.operationsDropMenuLoading.hide()}),60)}})});