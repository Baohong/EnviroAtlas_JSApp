//>>built
require({cache:{"url:widgets/HucNavigation/setting/SingleValueEdit.html":'\x3cdiv style\x3d"width:100%; padding-top: 3px;"\x3e\r\n  \x3cdiv class\x3d"error-message-div" data-dojo-attach-point\x3d"errorMessage"\x3e\x3c/div\x3e\r\n  \x3cspan data-dojo-attach-point\x3d"matchMsg" style\x3d"margin-top:11px;margin-bottom:11px;display:none;"\x3e\r\n        \x3cspan\x3e${nls.strMatchMsgPart1}\x3c/span\x3e\r\n  \x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n    \x3coption value\x3d"AND" selected\x3e${nls.all}\x3c/option\x3e\r\n    \x3coption value\x3d"OR"\x3e${nls.any}\x3c/option\x3e\r\n  \x3c/select\x3e\r\n  \x3cspan\x3e${nls.strMatchMsgPart2}\x3c/span\x3e\r\n  \x3c/span\x3e\r\n  \x3ctable class\x3d"setting-table" cellpadding\x3d"10px"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"uniqueMessageTR" style\x3d"display: none;"\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv style\x3d"margin-bottom: 8px; height: 18px;"\x3e\r\n            \x3cdiv class\x3d"uniqueBusy"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"uniqueMessage" data-dojo-attach-point\x3d"uniqueMessageNode"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"cancelUnique" data-dojo-attach-point\x3d"uniqueCancelNode"\x3e${nls.cancel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"fields-td" nowrap\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-attach-event\x3d"change:_onFieldsSelectChange" data-dojo-props\x3d"searchAttr:\'displayName\',required:true,intermediateChanges:true" class\x3d"dijit-form-FilteringSelect" style\x3d"width:100%;height:28px;"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"operators-td" nowrap\x3e\r\n          \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onOperatorsSelectChange" style\x3d"width:100%;height:28px;" class\x3d"dijit-form-Select"\x3e\r\n            \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n          \x3c/select\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"value-td" nowrap\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"value-container"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"allValueBoxContainer" style\x3d"width:100%;"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"stringTextBoxContainer" style\x3d"width:100%;"\x3e\r\n                  \x3cinput data-dojo-attach-point\x3d"stringTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:100%;height:28px;" class\x3d"dijit-form-ValidationTextBox" /\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"stringCodedValuesFS" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"searchAttr:\'name\',intermediateChanges:true" class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;height:28px;"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"numberTextBoxContainer" style\x3d"display:none;"\x3e\r\n                  \x3cinput data-dojo-attach-point\x3d"numberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"intermediateChanges:true,constraints: {pattern: \'#####0.##########\'}" class\x3d"dijit-form-NumberTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                  \x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"display:none;width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd style\x3d"width:40%;"\x3e\r\n                          \x3cinput data-dojo-attach-point\x3d"numberTextBox1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d"intermediateChanges:true,constraints: {pattern: \'#####0.##########\'}" class\x3d"dijit-form-NumberTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n                          \x3cspan\x3e${nls.and}\x3c/span\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd style\x3d"width:40%;"\x3e\r\n                          \x3cinput data-dojo-attach-point\x3d"numberTextBox2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d"intermediateChanges:true,constraints: {pattern: \'#####0.##########\'}" class\x3d"dijit-form-NumberTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n\r\n                  \x3cdiv data-dojo-attach-point\x3d"numberCodedValuesFS" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"searchAttr:\'name\',intermediateChanges:true" class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;height:28px;"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n\r\n                \x3cdiv data-dojo-attach-point\x3d"dateTextBoxContainer" style\x3d"display:none;"\x3e\r\n                  \x3cinput data-dojo-attach-point\x3d"dateTextBox" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-props\x3d"value:new Date(),trim:true,constraints:{datePattern: \'yyyy-MM-dd\'}" class\x3d"dijit-form-DateTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                  \x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"display:none;width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd style\x3d"width:40%;"\x3e\r\n                          \x3cinput data-dojo-attach-point\x3d"dateTextBox1" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d"value:new Date(),trim:true,constraints:{datePattern: \'yyyy-MM-dd\'}" class\x3d"dijit-form-DateTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n                          \x3cspan\x3e${nls.and}\x3c/span\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd\x3e\r\n                          \x3cinput data-dojo-attach-point\x3d"dateTextBox2" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d"value:new Date(),trim:true,constraints:{datePattern: \'yyyy-MM-dd\'}" class\x3d"dijit-form-DateTextBox" style\x3d"width:100%;height:28px;" /\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd colspan\x3d"3"\x3e\r\n                          \x3cdiv style\x3d"padding-top:8px; width:100%;"\x3e\r\n                            \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxDateMinus" data-dojo-props\x3d"label:\'${nls.startdateminus}\'"\x3e\x3c/div\x3e\r\n                            \x3cinput data-dojo-attach-point\x3d"dateNumberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"intermediateChanges:true,constraints: {pattern: \'#####0.##########\'}" class\x3d"dijit-form-NumberTextBox" style\x3d"width:20%;height:30px;" /\x3e\r\n                            \x3cspan\x3e\x26nbsp;${nls.days}\x3c/span\x3e\r\n                          \x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"uniqueValuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"searchAttr:\'name\'" class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;height:28px;"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"radio-table-container"\x3e\r\n              \x3ctable class\x3d"radio-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"valueRadio" checked\x3d"true" disabled title\x3d"${nls.valueTooltip}" /\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"valueLabel" title\x3d"${nls.valueTooltip}"\x3e${nls.value}\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"predefinedRadio" disabled title\x3d"${nls.predefinedTooltip}" /\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"predefinedLabel" title\x3d"${nls.predefinedTooltip}"\x3e${nls.predefined}\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd data-dojo-attach-point\x3d"uniqueTd"\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"uniqueRadio" disabled title\x3d"${nls.uniqueValueTooltip}" /\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"uniqueLabel" title\x3d"${nls.uniqueValueTooltip}"\x3e${nls.unique}\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3cdiv class\x3d"askvalues"\x3e\r\n      \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" class\x3d"askvalues-checkbox"\r\n           data-dojo-props\x3d"checked: false,label:\'${nls.askForValues}\'"\r\n           data-dojo-attach-event\x3d"onchange:_onCbxAskValuesClicked"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n                 data-dojo-props\x3d"required:true,trim:true,intermediateChanges:true" style\x3d"width:100%;" class\x3d"dijit-form-ValidationTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n                 data-dojo-props\x3d"required:true,trim:true,intermediateChanges:true" style\x3d"width:100%;" class\x3d"dijit-form-ValidationTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"user-list-tr" data-dojo-attach-point\x3d"valuesTable"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.list}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td-user-list"\x3e\r\n            \x3cdiv class\x3d"btn-add-section" data-dojo-attach-point\x3d"btnAddUserValue"\x3e\r\n              \x3cspan class\x3d"btn-add-icon"\x3e\x3c/span\x3e\r\n              \x3cspan class\x3d"btn-add-label"\x3e${nls.addListValue}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"user-values-table" style\x3d"width:100%;" data-dojo-attach-point\x3d"uservaluesTableDiv"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3ctable class\x3d"sql-setting-table" cellpadding\x3d"10px"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd style\x3d"width:100%;"\x3e\r\n                \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n                  \x3ctbody\x3e\r\n                    \x3c!--\x3ctr\x3e\r\n                        \x3ctd style\x3d"width:auto;" colspan\x3d"2"\x3e\r\n                            \x3cdiv\x3e\r\n                              \x3cinput class\x3d"override-checkbox" data-dojo-attach-point\x3d"cbxOverrideSQL" type\x3d"checkbox" data-dojo-attach-event\x3d"onchange:_onCbxOverrideSQLClicked" /\x3e\r\n                              \x3clabel\x3e${nls.overrideSQL}\x3c/label\x3e\r\n                          \x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                    \x3c/tr\x3e--\x3e\r\n                    \x3ctr\x3e\r\n                      \x3ctd colspan\x3d"2" style\x3d"width:auto;"\x3e\r\n                        \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxValueRequired"\r\n                             data-dojo-props\x3d"checked: false,label:\'${nls.expressionValueRequired}\'" style\x3d"margin-bottom:10px;"\x3e\x3c/div\x3e\r\n                      \x3c/td\x3e\r\n                    \x3c/tr\x3e\r\n                    \x3ctr\x3e\r\n                      \x3ctd style\x3d"width:135px;text-align:left;"\x3e\r\n                        \x3cspan\x3e${nls.valueSQL}\x3c/span\x3e\r\n                      \x3c/td\x3e\r\n                      \x3ctd style\x3d"width:auto;"\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-point\x3d"valueSQL" style\x3d"width:100%;" disabled\x3d"true" /\x3e\r\n                      \x3c/td\x3e\r\n                    \x3c/tr\x3e\r\n                  \x3c/tbody\x3e\r\n                \x3c/table\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/on dojo/json dojo/store/Memory dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Tooltip dojo/text!./SingleValueEdit.html dijit/form/TextBox esri/request esri/lang dojo/date/locale ../PagingQueryTask ./SimpleTable jimu/utils esri/layers/CodedValueDomain esri/layers/Domain dijit/form/FilteringSelect dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/NumberTextBox jimu/dijit/CheckBox".split(" "),
function(w,e,h,d,E,n,F,q,x,y,z,A,t,B,G,r,H,u,C,D,m,I,J){return w([y,z,A],{baseClass:"widget-esearch-singlevalue-setting",templateString:B,nls:null,config:null,tr:null,searchSetting:null,_fieldObj:null,_valueObj:null,layerURL:null,layerDef:null,stringFieldType:"esriFieldTypeString",dateFieldType:"esriFieldTypeDate",numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"],supportFieldTypes:[],_def:null,_layerInfo:null,isValueRequired:!1,
pagingAttempts:0,dayInMS:86399E3,pagingQueryTask:null,pagingWasCanceled:!1,layerUniqueCache:null,layerInfoCache:null,len:0,operator:null,isHosted:!1,OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",
stringOperatorIn:"stringOperatorIn",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsBeforeOrOn:"dateOperatorIsBeforeOrOn",dateOperatorIsAfterOrOn:"dateOperatorIsAfterOrOn",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",
dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",
numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",numberOperatorIn:"numberOperatorIn"},postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes)},postCreate:function(){this.inherited(arguments);this.uservaluesTable=new D({_rowHeight:40,
autoHeight:!0,selectable:!0,fields:[{name:"userlabel",title:this.nls.predefinedLabel,type:"text",editable:!0},{name:"uservalue",title:this.nls.predefinedValue,type:"text",editable:!0},{name:"actions",title:this.nls.actions,width:"120px",type:"actions",actions:["delete","up","down"]}]},this.uservaluesTableDiv);this.uservaluesTable.startup();d.addClass(this.uservaluesTable.domNode,"user-values-table");this._bindEvents()},startup:function(){this.inherited(arguments);this.popup.disableButton(0);this.setConfig(this.config);
this._checkExpressionNumbers();this.getLayerInfo();this._initRadios()},getLayerInfo:function(){this._layerInfo=this.layerInfoCache[this.layerURL];if(!this._layerInfo)return this._requestLayerInfo(this.layerURL);if(this._layerInfo.fields){var a=h.filter(this._layerInfo.fields,function(a){return"esriFieldTypeOID"!==a.type&&"esriFieldTypeBlob"!==a.type&&"esriFieldTypeGeometry"!==a.type&&"esriFieldTypeRaster"!==a.type&&"esriFieldTypeGUID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeXML"!==
a.type});0<a.length&&this._initFieldsSelect(a)}},_requestLayerInfo:function(a){if(a){r.setRequestPreCallback(function(a){a.failOk=!0;return a});var b=new x;this._def&&!this._def.isFulfilled()&&this._def.cancel("new layer info was requested");this._def=r({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback",timeout:2E4},{useProxy:!1});this._def.then(e.hitch(this,function(a){this._layerInfo=a;this.layerInfoCache[this.layerURL]=this._layerInfo;a&&a.fields&&(a=h.filter(a.fields,function(a){return"esriFieldTypeOID"!==
a.type&&"esriFieldTypeBlob"!==a.type&&"esriFieldTypeGeometry"!==a.type&&"esriFieldTypeRaster"!==a.type&&"esriFieldTypeGUID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeXML"!==a.type}),0<a.length&&this._initFieldsSelect(a))}),e.hitch(this,function(a){"Request canceled"!=a.message&&console.error("request layer info failed",a);this._layerInfo=null}));r.setRequestPreCallback();return b}},setConfig:function(a){this.config=a;this.resetAll();this.config&&(this.config.uniquevalsfromfield&&0<
this.config.uniquevalsfromfield.length&&(this.uniqueRadio.checked=!0,this.valueRadio.checked=!1,this.predefinedRadio.checked=!1),this.config.date1minus&&(this.cbxDateMinus.setValue(!0),this.dateNumberTextBox.set("value",parseInt(this.config.date1minus,10))),this.operatorsSelect.set("value",e.trim(this.config.operation||"")),this.valueSQL.set("value",e.trim(this.config.sqltext||"")),this._fieldObj=this.config.fieldObj,this.promptTB.set("value",this.config.prompt||""),this.hintTB.set("value",this.config.textsearchhint||
""),this._valueObj=this.config.valueObj,this.allAnySelect.value=this.config.operator,this.config.userlist&&0<this.config.userlist.length&&(this.cbxAskValues.setValue(!0),this.predefinedRadio.checked=!0,this.valueRadio.checked=!1,this.uniqueRadio.checked=!1,this.uservaluesTable.clear(),this.unConcatUserListVals(this.config.userlist)),this.config.hasOwnProperty("required")&&(this.cbxValueRequired.setValue(!0),this.isValueRequired=!0))},getConfig:function(){if(!this.validate(!1))return!1;this._getValue();
this.buildSQL();var a={fieldObj:this._fieldObj,valueObj:this._valueObj,prompt:e.trim(this.promptTB.get("value")),textsearchhint:e.trim(this.hintTB.get("value")),sqltext:e.trim(this.valueSQL.get("value")),operation:e.trim(this.operatorsSelect.get("value"))};!this.cbxDateMinus.getValue()||a.operation!==this.OPERATORS.dateOperatorIsBetween&&a.operation!==this.OPERATORS.dateOperatorIsNotBetween?delete a.date1minus:a.date1minus=parseInt(this.dateNumberTextBox.get("value"),10);if(a.operation===this.OPERATORS.stringOperatorIsBlank||
a.operation===this.OPERATORS.stringOperatorIsNotBlank||a.operation===this.OPERATORS.numberOperatorIsBlank||a.operation===this.OPERATORS.numberOperatorIsNotBlank||a.operation===this.OPERATORS.dateOperatorIsBlank||a.operation===this.OPERATORS.dateOperatorIsNotBlank)a.prompt=(a.fieldObj.alias||a.fieldObj.name)+" "+this.nls[a.operation];this.uniqueRadio.checked&&(a.uniquevalsfromfield=this._fieldObj.name);"block"===d.getStyle(this.matchMsg,"display")&&(a.operator=this.allAnySelect.value);this.predefinedRadio.checked&&
(a.userlist=this.concatUserListVals());this.cbxValueRequired.getValue()?a.required=!0:a.hasOwnProperty("required")&&delete a.required;return this.config=a},trimArray:function(a){for(var b=0;b<a.length;b++)a[b]=a[b].replace(/^\s*/,"").replace(/\s*$/,"");return a},unConcatUserListVals:function(a){if(-1<a.indexOf("',")){a=this.trimArray(a.split("',"));a=h.map(a,function(a,b){return String(a)+"'"});var b=String(a[a.length-1]);"'"==b.substring(b.length-1)&&(a[a.length-1]=b.substring(0,b.length-1))}else a=
this.trimArray(a.split(","));var c;h.forEach(a,e.hitch(this,function(a){var b=[];0>a.indexOf("|")?(b[0]=a,b[1]=a):b=a.split("|");c={userlabel:b[0],uservalue:b[1]};this._createUserValue(c)}))},concatUserListVals:function(){var a=this.uservaluesTable.getData();return h.map(a,e.hitch(this,function(a){return a.userlabel+"|"+a.uservalue})).join(",")},resetAll:function(){this.promptTB.set("value","");this.valueSQL.set("value","");this.hintTB.set("value","")},_getShortTypeByFieldType:function(a){return a===
this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_checkExpressionNumbers:function(){1<this.len?(this.allAnySelect.value=this.operator,d.setStyle(this.matchMsg,"display","block")):d.setStyle(this.matchMsg,"display","none")},_initFieldsSelect:function(a){var b=h.map(a,e.hitch(this,function(a,b){var c=e.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);a="";"string"===c.shortType?a=this.nls.string:
"number"===c.shortType?a=this.nls.number:"date"===c.shortType&&(a=this.nls.date);c.displayName=c.alias+" ("+a+")";return c}));if(0<b.length){var c=new q({data:b});this.fieldsSelect.set("store",c);this.fieldsSelect.set("value",b[0].id)}this.fieldsSelect.focusNode.focus();this.fieldsSelect.focusNode.blur();this._fieldObj={name:a[0].name,label:a[0].alias||a[0].name,shortType:this._getShortTypeByFieldType(a[0].type),type:a[0].type};this.config&&this.config.fieldObj&&this._setValueOptions()},_setValueOptions:function(){var a=
this.config.fieldObj.name,b=this.config.operation;this._valueObj=this.config.valueObj;a=this.fieldsSelect.store.query({name:a});0!==a.length&&(a=a[0])&&(this.fieldsSelect.set("value",a.id),setTimeout(e.hitch(this,function(){this.domNode&&(""!==this.config.prompt&&this.cbxAskValues.setValue(!0),this.operatorsSelect.set("value",b),setTimeout(e.hitch(this,function(){this.domNode&&this._resetByFieldAndOperation()}),200),setTimeout(e.hitch(this,function(){this.domNode&&(this._updatePrompt(),this.promptTB.set("value",
this.config.prompt||""),this.hintTB.set("value",this.config.textsearchhint||""),this._checkExpressionNumbers())}),100))}),0))},_isFieldCoded:function(a){return(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length},_isFieldSubType:function(a){return this._layerInfo.typeIdField?this._layerInfo.typeIdField.toUpperCase()===a.name.toUpperCase():!1},_focusValidationTextBox:function(a){a&&a.focusNode&&a.focusNode.focus()},_onFieldsSelectChange:function(){this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());
this.operatorsSelect.addOption({value:"none",label:this.nls.none});!1===this.uniqueRadio.checked&&!1===this.predefinedRadio.checked&&(this.valueRadio.checked=!0);var a=this._getSelectedFilteringItem(this.fieldsSelect);if(a){this.operatorsSelect.shortType=a.shortType;var b=this._getOperatorsByShortType(a.shortType);this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());h.forEach(b,e.hitch(this,function(a){this.operatorsSelect.addOption({value:a,label:this.nls[a]})}))}this._fieldObj={name:a.name,
label:a.alias||a.name,shortType:a.shortType,type:a.type};this._onOperatorsSelectChange();this.hintTB.set("value","")},_getSelectedFilteringItem:function(a){if(a.validate()){var b=a.get("value");if(isNaN(b))this._showValidationErrorTip(a);else if(a=a.store.query({id:b}),0<a.length&&(a=a[0]))return a}else this._showValidationErrorTip(a);return null},_showValidationErrorTip:function(a){!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())},_getOperatorsByShortType:function(a){var b=
[];"string"===a?b=[this.OPERATORS.stringOperatorIs,this.OPERATORS.stringOperatorIsNot,this.OPERATORS.stringOperatorStartsWith,this.OPERATORS.stringOperatorEndsWith,this.OPERATORS.stringOperatorContains,this.OPERATORS.stringOperatorDoesNotContain,this.OPERATORS.stringOperatorIsBlank,this.OPERATORS.stringOperatorIsNotBlank,this.OPERATORS.stringOperatorIn]:"number"===a?b=[this.OPERATORS.numberOperatorIs,this.OPERATORS.numberOperatorIsNot,this.OPERATORS.numberOperatorIsAtLeast,this.OPERATORS.numberOperatorIsLessThan,
this.OPERATORS.numberOperatorIsAtMost,this.OPERATORS.numberOperatorIsGreaterThan,this.OPERATORS.numberOperatorIsBetween,this.OPERATORS.numberOperatorIsNotBetween,this.OPERATORS.numberOperatorIsBlank,this.OPERATORS.numberOperatorIsNotBlank,this.OPERATORS.numberOperatorIn]:"date"===a&&(b=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBeforeOrOn,this.OPERATORS.dateOperatorIsAfterOrOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,
this.OPERATORS.dateOperatorIsBetween,this.OPERATORS.dateOperatorIsNotBetween,this.OPERATORS.dateOperatorIsBlank,this.OPERATORS.dateOperatorIsNotBlank]);return b},_onOperatorsSelectChange:function(){!1===this.uniqueRadio.checked&&!1===this.predefinedRadio.checked&&(this.valueRadio.checked=!0);var a=this.operatorsSelect.get("value");this.cbxDateMinus.getValue()&&a!==this.OPERATORS.dateOperatorIsBetween&&a!==this.OPERATORS.dateOperatorIsNotBetween&&this.cbxDateMinus.setValue(!1);!this.config.date1minus||
a!==this.OPERATORS.dateOperatorIsBetween&&a!==this.OPERATORS.dateOperatorIsNotBetween||this.cbxDateMinus.setValue(!0);if(a===this.OPERATORS.stringOperatorIsBlank||a===this.OPERATORS.stringOperatorIsNotBlank||a===this.OPERATORS.numberOperatorIsBlank||a===this.OPERATORS.numberOperatorIsNotBlank||a===this.OPERATORS.dateOperatorIsBlank||a===this.OPERATORS.dateOperatorIsNotBlank)this.valueRadio.checked=!0,this.cbxAskValues.setValue(!1),this.cbxAskValues.status=!1,this.cbxValueRequired.status=!1,d.setStyle(this.attributeValueContainer,
"display","none");this._resetByFieldAndOperation()},_onRangeNumberBlur:function(){if(this.numberTextBox1.validate()&&this.numberTextBox2.validate()){var a=this._getValueForNumberTextBox(this.numberTextBox1),b=this._getValueForNumberTextBox(this.numberTextBox2);m.isValidNumber(a)&&m.isValidNumber(b)&&a>b&&(this._setValueForNumberTextBox(this.numberTextBox1,b),this._setValueForNumberTextBox(this.numberTextBox2,a))}this._resetByFieldAndOperation()},_getProcessedString:function(a){return m.isNotEmptyString(a,
!0)?a:""},_getProcessedNumber:function(a){return m.isValidNumber(a)?a:null},_setValueForStringTextBox:function(a,b){b=this._getProcessedString(b);a.set("value",b)},_setValueForNumberTextBox:function(a,b){m.isValidNumber(b)&&a.set("value",b)},_getValueForNumberTextBox:function(a){a=a.get("value");return this._getProcessedNumber(a)},_onRangeDateBlur:function(){if(this.dateTextBox1.validate()&&this.dateTextBox2.validate()){var a=this.dateTextBox1.get("value"),b=a.getTime(),c=this.dateTextBox2.get("value"),
d=c.getTime();b>d&&(this.dateTextBox1.set("value",c),this.dateTextBox2.set("value",a))}this._resetByFieldAndOperation()},_createUserValue:function(a){if(!this.uservaluesTable.addRow(a).success)return null},_changeStartDate:function(){if(this.cbxDateMinus.getValue()){var a=this.dateNumberTextBox.get("value");a&&(a=parseInt(a,10),a=new Date((new Date).getTime()-this.dayInMS*a),this.dateTextBox1.set("value",a))}else this.dateTextBox1.set("value",new Date)},_bindEvents:function(){this.own(n(this.dateNumberTextBox,
"change",e.hitch(this,this._changeStartDate)));this.cbxDateMinus.onChange=e.hitch(this,this._changeStartDate);this.own(n(this.numberTextBox,"change",e.hitch(this,this._checkProceed)));this.own(n(this.dateTextBox,"change",e.hitch(this,this._checkProceed)));this.own(n(this.stringTextBox,"change",e.hitch(this,this._checkProceed)));this.own(n(this.hintTB,"change",e.hitch(this,this._checkProceed)));this.own(n(this.btnAddUserValue,"click",e.hitch(this,function(){this._createUserValue({userlabel:"",uservalue:""})})));
this.cbxAskValues.onChange=e.hitch(this,this._onCbxAskValuesClicked);this.cbxValueRequired.onChange=e.hitch(this,function(){this._valueObj=this.config.valueObj;var a=this.fieldsSelect?this._getSelectedFilteringItem(this.fieldsSelect):null;a&&this.layerURL&&this.layerUniqueCache[this.layerURL]&&delete this.layerUniqueCache[this.layerURL][a.name];this._resetByFieldAndOperation()})},_checkProceed:function(){if(this.popup){var a="",b=!0;d.setAttr(this.errorMessage,"innerHTML","");this.cbxAskValues.getValue()&&
""===e.trim(this.hintTB.get("value"))&&(b=!1,a+=this.nls.hint+" "+this.nls.requiredfield+" ");this.valueRadio.checked&&this.cbxValueRequired.getValue()&&(this._getValue(),this._valueObj.value||this._valueObj.value1||this._valueObj.value2||(b=!1,a=""===a?a+(this.nls.value+" "+this.nls.requiredfield+" "):a+(", "+this.nls.value+" "+this.nls.requiredfield)));b?this.popup.enableButton(0):(this.popup.disableButton(0),a&&d.setAttr(this.errorMessage,"innerHTML",a))}},validate:function(a){return""===e.trim(this.valueSQL.get("value"))?
(a&&this._showTooltip(this.valueSQL.domNode,"Please input value."),!1):this.cbxAskValues.getValue()&&""===e.trim(this.hintTB.get("value"))?(a&&this._showTooltip(this.hintTB.domNode,"Please input value."),!1):!0},_showTooltip:function(a,b,c){this._scrollToDom(a);t.show(b,a);setTimeout(function(){t.hide(a)},c?c:2E3)},_scrollToDom:function(a){var b=this.searchSetting.domNode.parentNode,c=d.position(b).y;a=d.position(a).y;b.scrollTop=a-c},_initRadios:function(){var a="radio_"+m.getRandomString();this.valueRadio.name=
a;m.combineRadioCheckBoxWithLabel(this.valueRadio,this.valueLabel);this.own(n(this.valueRadio,"click",e.hitch(this,this._resetByFieldAndOperation)));this.uniqueRadio&&(this.uniqueRadio.name=a,m.combineRadioCheckBoxWithLabel(this.uniqueRadio,this.uniqueLabel),this.own(n(this.uniqueRadio,"click",e.hitch(this,this._resetByFieldAndOperation))));this.predefinedRadio&&(this.predefinedRadio.name=a,m.combineRadioCheckBoxWithLabel(this.predefinedRadio,this.predefinedLabel),this.own(n(this.predefinedRadio,
"click",e.hitch(this,this._resetByFieldAndOperation))));this._resetByFieldAndOperation()},_enableRadios:function(){this.valueRadio.disabled=!1;d.setStyle(this.valueLabel,"color","initial");this.uniqueRadio&&(this.uniqueRadio.disabled=!1,d.setStyle(this.uniqueLabel,"color","initial"));this.predefinedRadio&&this.cbxAskValues.getValue()&&(this.predefinedRadio.disabled=!1,d.setStyle(this.predefinedLabel,"color","initial"))},_disableRadios:function(){this.valueRadio.disabled=!0;d.setStyle(this.valueLabel,
"color","lightgray");this.uniqueRadio&&(this.uniqueRadio.disabled=!0,d.setStyle(this.uniqueLabel,"color","lightgray"));this.predefinedRadio&&(this.predefinedRadio.disabled=!0,d.setStyle(this.predefinedLabel,"color","lightgray"))},_resetByFieldAndOperation:function(){this.isValueRequired=this.cbxValueRequired.getValue();d.setStyle(this.attributeValueContainer,"display","block");this._enableRadios();var a=this.fieldsSelect?this._getSelectedFilteringItem(this.fieldsSelect):null,b=a&&a.shortType,c=this.operatorsSelect.get("value");
if(a)if("string"===b)switch(c){case this.OPERATORS.stringOperatorStartsWith:case this.OPERATORS.stringOperatorEndsWith:case this.OPERATORS.stringOperatorContains:case this.OPERATORS.stringOperatorDoesNotContain:case this.OPERATORS.stringOperatorIn:this.uniqueRadio.disabled=!0,d.setStyle(this.uniqueLabel,"color","lightgray")}else if("number"===b)switch(c){case this.OPERATORS.numberOperatorIsBetween:case this.OPERATORS.numberOperatorIsNotBetween:case this.OPERATORS.numberOperatorIn:this.valueRadio.checked=
!0,this._disableRadios()}else if("date"===b){switch(c){case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsNotBetween:this.valueRadio.checked=!0,this._disableRadios()}this.uniqueRadio&&(this.uniqueRadio.disabled=!0,d.setStyle(this.uniqueLabel,"color","lightgray"),this.uniqueRadio.checked&&(this.valueRadio.checked=!0))}this.buildSQL();this._updateUIOfAttrValueContainer(a,c)},buildSQL:function(){var a="",b,c,d=this.operatorsSelect.get("value");this.uniqueRadio.checked||this.predefinedRadio.checked||
d==this.OPERATORS.stringOperatorIn?c=b="":(b="Upper(",c=")");var f,l,k;this._valueObj?(f=this._valueObj.value||"",l=this._valueObj.value1||"",k=this._valueObj.value2||""):k=l=f="";var g=this.fieldsSelect?this._getSelectedFilteringItem(this.fieldsSelect):null,v=g&&g.shortType;this.cbxAskValues.getValue()&&(f="[value]",l="[value1]",k="[value2]");if("string"===v)switch(d){case this.OPERATORS.stringOperatorIn:a=b+g.name+c+" IN ("+b+"'"+f.replace(/\'/g,"''")+"'"+c+")";break;case this.OPERATORS.stringOperatorIs:a=
b+g.name+c+" \x3d "+b+"'"+f.replace(/\'/g,"''")+"'"+c;break;case this.OPERATORS.stringOperatorIsNot:a=b+g.name+c+" \x3c\x3e "+b+"'"+f.replace(/\'/g,"''")+"'"+c;break;case this.OPERATORS.stringOperatorStartsWith:a=b+g.name+c+" LIKE "+b+"'"+f.replace(/\'/g,"''")+"%'"+c;break;case this.OPERATORS.stringOperatorEndsWith:a=b+g.name+c+" LIKE "+b+"'%"+f.replace(/\'/g,"''")+"'"+c;break;case this.OPERATORS.stringOperatorContains:a=b+g.name+c+" LIKE "+b+"'%"+f.replace(/\'/g,"''")+"%'"+c;break;case this.OPERATORS.stringOperatorDoesNotContain:a=
b+g.name+c+" NOT LIKE "+b+"'%"+f.replace(/\'/g,"''")+"%'"+c;break;case this.OPERATORS.stringOperatorIsBlank:a=g.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:a=g.name+" IS NOT NULL"}else if("number"===v)switch(d){case this.OPERATORS.numberOperatorIn:a=g.name+" IN ("+f+")";break;case this.OPERATORS.numberOperatorIs:a=g.name+" \x3d "+f;break;case this.OPERATORS.numberOperatorIsNot:a=g.name+" \x3c\x3e "+f;break;case this.OPERATORS.numberOperatorIsAtLeast:a=g.name+" \x3e\x3d "+f;
break;case this.OPERATORS.numberOperatorIsLessThan:a=g.name+" \x3c "+f;break;case this.OPERATORS.numberOperatorIsAtMost:a=g.name+" \x3c\x3d "+f;break;case this.OPERATORS.numberOperatorIsGreaterThan:a=g.name+" \x3e "+f;break;case this.OPERATORS.numberOperatorIsBetween:a=g.name+" BETWEEN "+l+" AND "+k;break;case this.OPERATORS.numberOperatorIsNotBetween:a=g.name+" NOT BETWEEN "+l+" AND "+k;break;case this.OPERATORS.numberOperatorIsBlank:a=g.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:a=
g.name+" IS NOT NULL"}else switch(!1===this.cbxAskValues.getValue()?(f&&""!==f&&"[value]"!==f&&(f=new Date(f)),l&&(l=new Date(l)),k&&(k=new Date(k))):(f&&(f="[value]"),l&&(l="[value1]"),k&&(k="[value2]")),d){case this.OPERATORS.dateOperatorIsOn:a=g.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(f))+"' AND "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(this.addDay(f)))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:a=
g.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(f))+"' AND "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(this.addDay(f)))+"'";break;case this.OPERATORS.dateOperatorIsBefore:a=g.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(f))+"'";break;case this.OPERATORS.dateOperatorIsAfter:a=g.name+" \x3e "+(this.isHosted?"":"timestamp ")+
"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(this.addDay(f)))+"'";break;case this.OPERATORS.dateOperatorIsBeforeOrOn:a=g.name+" \x3c\x3d "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(f))+"'";break;case this.OPERATORS.dateOperatorIsAfterOrOn:a=g.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value]":this.formatDate(this.addDay(f)))+"'";break;case this.OPERATORS.dateOperatorIsBetween:a=g.name+" BETWEEN "+
(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value1]":this.formatDate(l))+"' AND "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value2]":this.formatDate(this.addDay(k)))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:a=g.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value1]":this.formatDate(l))+"' AND "+(this.isHosted?"":"timestamp ")+"'"+(this.cbxAskValues.getValue()?"[value2]":this.formatDate(this.addDay(k)))+
"'";break;case this.OPERATORS.dateOperatorIsBlank:a=g.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:a=g.name+" IS NOT NULL"}this.valueSQL.set("value",e.trim(a))},formatDate:function(a){if("[value]"===a||""===a)return a;var b=u.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=u.format(a,{selector:"time",timePattern:"HH:mm:ss"});return b+" "+a},addDay:function(a){return"[value]"===a||""===a?a:new Date(a.getTime()+this.dayInMS)},_updateUIOfAttrValueContainer:function(a,b){this._updatePrompt();
var c=a&&a.shortType;if("string"===c||"number"===c||"date"===c)if(d.setStyle(this.attributeValueContainer,"display","block"),this.valueRadio.checked)if(d.setStyle(this.valuesTable,"display","none"),d.setStyle(this.uniqueValuesSelect.domNode,"display","none"),this._showAllValueBoxContainer(),this._resetValueTextBox(),"string"===c)d.setStyle(this.stringTextBoxContainer,"display","block"),d.setStyle(this.numberTextBoxContainer,"display","none"),d.setStyle(this.dateTextBoxContainer,"display","none"),
this._isFieldCoded(a)&&b===this.OPERATORS.stringOperatorIs?(d.setStyle(this.stringCodedValuesFS.domNode,"display","inline-block"),d.setStyle(this.stringTextBox.domNode,"display","none"),a=h.map(a.domain.codedValues,e.hitch(this,function(a,b){a=e.mixin({},a);a.id=b;return a})),this.isValueRequired||(c=e.mixin({},{name:"",code:""}),c.id=a.length,a.unshift(c)),c=new q({data:a}),this.stringCodedValuesFS.set("store",c),this._valueObj?(c=h.filter(a,e.hitch(this,function(a){return a.code===this._valueObj.value})),
0<c.length?this.stringCodedValuesFS.set("value",c[0].id):this.stringCodedValuesFS.set("value",a[0].id)):this.stringCodedValuesFS.set("value",a[0].id)):(d.setStyle(this.stringTextBox.domNode,"display","inline-block"),d.setStyle(this.stringCodedValuesFS.domNode,"display","none"),this._valueObj&&this._setValueForStringTextBox(this.stringTextBox,this._valueObj.value)),b!==this.OPERATORS.stringOperatorIsBlank&&b!==this.OPERATORS.stringOperatorIsNotBlank||d.setStyle(this.attributeValueContainer,"display",
"none");else if("number"===c){d.setStyle(this.stringTextBoxContainer,"display","none");d.setStyle(this.numberTextBoxContainer,"display","block");d.setStyle(this.dateTextBoxContainer,"display","none");if(b===this.OPERATORS.numberOperatorIsBetween||b===this.OPERATORS.numberOperatorIsNotBetween){if(d.setStyle(this.numberTextBox.domNode,"display","none"),d.setStyle(this.numberRangeTable,"display","table"),d.setStyle(this.numberCodedValuesFS.domNode,"display","none"),this._valueObj)if(a=m.isValidNumber(this._valueObj.value1),
c=m.isValidNumber(this._valueObj.value2),a&&c){a=parseFloat(this._valueObj.value1);var c=parseFloat(this._valueObj.value2),p=Math.max(a,c);this.numberTextBox1.set("value",Math.min(a,c));this.numberTextBox2.set("value",p)}else a&&!c?(a=parseFloat(this._valueObj.value1),this.numberTextBox1.set("value",a)):!a&&c&&(c=parseFloat(this._valueObj.value2),this.numberTextBox2.set("value",c))}else if(d.setStyle(this.numberRangeTable,"display","none"),this._isFieldCoded(a)&&b===this.OPERATORS.numberOperatorIs)if(d.setStyle(this.numberTextBox.domNode,
"display","none"),d.setStyle(this.numberCodedValuesFS.domNode,"display","inline-block"),a=h.map(a.domain.codedValues,e.hitch(this,function(a,b){a=e.mixin({},a);a.id=b;return a})),this.isValueRequired||(c=e.mixin({},{name:"",code:""}),c.id=a.length,a.unshift(c)),c=new q({data:a}),this.numberCodedValuesFS.set("store",c),this._valueObj&&!isNaN(this._valueObj.value)){var f=parseFloat(this._valueObj.value),c=h.filter(a,e.hitch(this,function(a){return parseFloat(a.code)===f}));0<c.length?this.numberCodedValuesFS.set("value",
c[0].id):this.numberCodedValuesFS.set("value",a[0].id)}else this.numberCodedValuesFS.set("value",a[0].id);else d.setStyle(this.numberTextBox.domNode,"display","inline-block"),d.setStyle(this.numberCodedValuesFS.domNode,"display","none"),this._valueObj&&(isNaN(this._valueObj.value)||this.numberTextBox.set("value",parseFloat(this._valueObj.value)));b!==this.OPERATORS.numberOperatorIsBlank&&b!==this.OPERATORS.numberOperatorIsNotBlank||d.setStyle(this.attributeValueContainer,"display","none")}else{if("date"===
c){d.setStyle(this.stringTextBoxContainer,"display","none");d.setStyle(this.numberTextBoxContainer,"display","none");d.setStyle(this.dateTextBoxContainer,"display","block");if(b===this.OPERATORS.dateOperatorIsBetween||b===this.OPERATORS.dateOperatorIsNotBetween){if(d.setStyle(this.dateTextBox.domNode,"display","none"),d.setStyle(this.dateRangeTable,"display","table"),this._valueObj&&this._valueObj.value1&&this._valueObj.value2){if("[value]"===this._valueObj.value1&&!this.dateminus)return;this.dateTextBox1.set("value",
new Date(this._valueObj.value1));this.dateTextBox2.set("value",new Date(this._valueObj.value2))}}else if(d.setStyle(this.dateTextBox.domNode,"display","inline-block"),d.setStyle(this.dateRangeTable,"display","none"),this._valueObj&&this._valueObj.value){if("[value]"===this._valueObj.value)return;this.dateTextBox.set("value",new Date(this._valueObj.value))}b!==this.OPERATORS.dateOperatorIsBlank&&b!==this.OPERATORS.dateOperatorIsNotBlank||d.setStyle(this.attributeValueContainer,"display","none")}}else this.uniqueRadio&&
this.uniqueRadio.checked?(this._hideAllValueBoxContainer(),d.setStyle(this.uniqueValuesSelect.domNode,"display","inline-block"),d.setStyle(this.valuesTable,"display","none"),this._resetUniqueValuesSelect()):this.predefinedRadio&&this.predefinedRadio.checked&&(this._hideAllValueBoxContainer(),d.setStyle(this.valuesTable,"display","table-row"));else d.setStyle(this.attributeValueContainer,"display","none")},_showAllValueBoxContainer:function(){d.setStyle(this.allValueBoxContainer,"display","block")},
_hideAllValueBoxContainer:function(){d.setStyle(this.allValueBoxContainer,"display","none")},_resetValueTextBox:function(){this.stringTextBox.set("value","");this.numberTextBox.set("value","");this.dateTextBox.set("value",new Date)},_getValue:function(){this._valueObj||(this._valueObj={});var a=this._getSelectedFilteringItem(this.fieldsSelect);if(!a)return null;var b=a.shortType,c=this.operatorsSelect.get("value");if(this.valueRadio.checked)if("string"===b)if(c===this.OPERATORS.stringOperatorIsBlank||
c===this.OPERATORS.stringOperatorIsNotBlank)this._valueObj.value=null;else if(this._isFieldCoded(a)&&c===this.OPERATORS.stringOperatorIs){if(!this.stringCodedValuesFS.validate())return this._showValidationErrorTip(this.stringCodedValuesFS),null;b=this._getSelectedFilteringItem(this.stringCodedValuesFS);this._valueObj.value=b.code}else{if(!this.stringTextBox.validate())return this._showValidationErrorTip(this.stringTextBox),null;this._valueObj.value=this.stringTextBox.get("value")}else if("number"===
b)if(c===this.OPERATORS.numberOperatorIsBlank||c===this.OPERATORS.numberOperatorIsNotBlank)this._valueObj.value=null;else if(c===this.OPERATORS.numberOperatorIsBetween||c===this.OPERATORS.numberOperatorIsNotBetween){if(!this.numberTextBox1.validate())return this._showValidationErrorTip(this.numberTextBox1),null;if(!this.numberTextBox2.validate())return this._showValidationErrorTip(this.numberTextBox2),null;this._valueObj.value1=parseFloat(this.numberTextBox1.get("value"));this._valueObj.value2=parseFloat(this.numberTextBox2.get("value"));
delete this._valueObj.value}else if(this._isFieldCoded(a)&&c===this.OPERATORS.numberOperatorIs){if(!this.numberCodedValuesFS.validate())return this._showValidationErrorTip(this.numberCodedValuesFS),null;b=this._getSelectedFilteringItem(this.numberCodedValuesFS);this._valueObj.value=parseFloat(b.code)}else if(this._isFieldSubType(a)&&c===this.OPERATORS.numberOperatorIs){if(!this.numberCodedValuesFS.validate())return this._showValidationErrorTip(this.numberCodedValuesFS),null;b=this._getSelectedFilteringItem(this.numberCodedValuesFS);
this._valueObj.value=parseFloat(b.code)}else{if(!this.numberTextBox.validate())return this._showValidationErrorTip(this.numberTextBox),null;this._valueObj.value=parseFloat(this.numberTextBox.get("value"))}else{if("date"===b)if(c===this.OPERATORS.dateOperatorIsBlank||c===this.OPERATORS.dateOperatorIsNotBlank)this._valueObj.value=null;else if(c===this.OPERATORS.dateOperatorIsBetween||c===this.OPERATORS.dateOperatorIsNotBetween){if(!this.dateTextBox1.validate())return this._showValidationErrorTip(this.dateTextBox1),
null;if(!this.dateTextBox2.validate())return this._showValidationErrorTip(this.dateTextBox2),null;this.cbxAskValues.getValue()?(this._valueObj.value1="[value]",this._valueObj.value2="[value]"):(this._valueObj.value1=this.dateTextBox1.get("value").toDateString(),this._valueObj.value2=this.dateTextBox2.get("value").toDateString());delete this._valueObj.value}else{if(!this.dateTextBox.validate())return this._showValidationErrorTip(this.dateTextBox),null;this._valueObj.value=this.dateTextBox.get("value").toDateString()}}else if(this.uniqueRadio&&
this.uniqueRadio.checked){a=this._getSelectedFilteringItem(this.uniqueValuesSelect);if(!a)return this._showValidationErrorTip(this.uniqueValuesSelect),null;"string"===b?this._valueObj.value=a.code:"number"===b&&(this._valueObj.value=parseFloat(a.code))}},_resetUniqueValuesSelect:function(){if(this.pagingWasCanceled)this._type=1,this._showDijit(this.stringTextBox),this._hideDijit(this.uniqueValuesSelect),this.stringTextBox.set("value",""),d.setStyle(this.uniqueMessageTR,"display","none"),this.uniqueMessageNode.innerHTML=
"";else{this.uniqueValuesSelect.set("displayedValue","");var a=new q({data:[]});this.uniqueValuesSelect.set("store",a);if(this._layerInfo){var b=this.fieldsSelect?this._getSelectedFilteringItem(this.fieldsSelect):null;if(b){var c,p;p=this.disableuvcache?null:this.layerUniqueCache[this.layerURL];p||(p={},this.layerUniqueCache[this.layerURL]=p);var f=b.name;if(f in p)c=p[f],a=new q({data:c}),this.uniqueValuesSelect&&a&&(this.uniqueValuesSelect.set("store",a),this._valueObj&&this._valueObj.value?(a=
h.filter(this.uniqueValuesSelect.store.data,e.hitch(this,function(a){return a.code===this._valueObj.value})),0<a.length&&this.uniqueValuesSelect.set("value",a[0].id)):this.isValueRequired&&this.uniqueValuesSelect.set("value",0));else if(this.pagingWasCanceled)this._type=1,this._showDijit(this.stringTextBox),this._hideDijit(this.uniqueValuesSelect),this.stringTextBox.set("value",""),d.setStyle(this.uniqueMessageTR,"display","none"),this.uniqueMessageNode.innerHTML="";else{this.pagingAttempts=0;this.pagingQueryTask=
new C;this.own(n(this.uniqueCancelNode,"click",e.hitch(this,function(){this.pagingWasCanceled=this.pagingQueryTask.esc=this.pagingQueryTask.pagingEscaped=!0;d.setStyle(this.uniqueMessageTR,"display","none");this.uniqueMessageNode.innerHTML=""})));this.pagingQueryTask.uri=this.layerURL;this.pagingQueryTask.fieldName=b.name;this.pagingQueryTask.dateFormat="";this.pagingQueryTask.version=this._layerInfo.currentVersion;this.pagingQueryTask.maxRecordCount=this._layerInfo.maxRecordCount;this.pagingQueryTask.isRequired=
this.isValueRequired;if(this.layerDef)return this.pagingQueryTask.defExpr=this.layerDef,!1;this.pagingQueryTask.on("pagingComplete",e.hitch(this,function(a){d.setStyle(this.uniqueMessageTR,"display","none");this.uniqueMessageNode.innerHTML="";this.pagingAttempts=0;var k=!1;this._layerInfo.typeIdField&&(k=this._layerInfo.typeIdField.toUpperCase()===b.name.toUpperCase());c=h.map(a,e.hitch(this,function(a,b){if(k&&(""!==a.name||" "!==a.name)){var c=this._getFeatureType(this._layerInfo,a.name);c&&c.name&&
(a.name=c.name)}a=e.mixin({},a);a.id=b;return a}));if(this._isFieldCoded(b)){var g=b.domain;h.map(c,e.hitch(this,function(a){for(var b=0;b<g.codedValues.length;b++){var c=g.codedValues[b];if(a.code===c.code){a.name=c.name;break}}}))}if(this.pagingWasCanceled)return this._type=1,this._showDijit(this.stringTextBox),this._hideDijit(this.uniqueValuesSelect),this.stringTextBox.set("value",""),d.setStyle(this.uniqueMessageTR,"display","none"),this.uniqueMessageNode.innerHTML="",!0;p[f]=c;a=new q({data:c});
this.uniqueValuesSelect&&a&&(this.uniqueValuesSelect.set("store",a),this._valueObj&&this._valueObj.value?(a=h.filter(this.uniqueValuesSelect.store.data,e.hitch(this,function(a){return a.code===this._valueObj.value})),0<a.length&&this.uniqueValuesSelect.set("value",a[0].id)):this.isValueRequired&&this.uniqueValuesSelect.set("value",0))}));this.pagingQueryTask.on("pagingFault",e.hitch(this,function(){this.pagingAttempts++;4>=this.pagingAttempts&&!this.pagingWasCanceled?this.pagingQueryTask.execute():
(this._type=1,this._showDijit(this.stringTextBox),this._hideDijit(this.uniqueValuesSelect),this.stringTextBox.set("value",""),d.setStyle(this.uniqueMessageTR,"display","none"),this.uniqueMessageNode.innerHTML="")}));this.pagingQueryTask.startup();this.pagingQueryTask.execute();d.setStyle(this.uniqueMessageTR,"display","table-row");this.uniqueMessageNode.innerHTML=this.nls.uniqueValues;this.pagingQueryTask.on("featuresTotal",e.hitch(this,function(){d.setStyle(this.uniqueMessageTR,"display","table-row");
this.uniqueMessageNode.innerHTML=this.nls.processingUnique+this.pagingQueryTask.featuresProcessed+this.nls.of+this.pagingQueryTask.featuresTotal}));this.pagingQueryTask.on("featuresProcessed",e.hitch(this,function(){d.setStyle(this.uniqueMessageTR,"display","table-row");this.uniqueMessageNode.innerHTML=this.nls.processingUnique+this.pagingQueryTask.featuresProcessed+this.nls.of+this.pagingQueryTask.featuresTotal}))}}}}},_getFeatureType:function(a,b){var c;if(a)for(var d=0;d<a.types.length;d++){var e=
a.types[d];if(b===e.id){c=e;break}}return c},_onCbxAskValuesClicked:function(){this._updatePrompt();this.buildSQL();this.predefinedRadio&&(this.predefinedRadio.disabled=!1,d.setStyle(this.predefinedLabel,"color","initial"))},_updatePrompt:function(){this.promptTB.set("value","");this.cbxAskValues.status=!0;d.setStyle(this.promptTable,"display","table");var a=this.operatorsSelect.get("value"),b=this.nls[a];if(a===this.OPERATORS.stringOperatorIsBlank||a===this.OPERATORS.stringOperatorIsNotBlank||a===
this.OPERATORS.numberOperatorIsBlank||a===this.OPERATORS.numberOperatorIsNotBlank||a===this.OPERATORS.dateOperatorIsBlank||a===this.OPERATORS.dateOperatorIsNotBlank){if(!0===this.uniqueRadio.checked||!0===this.predefinedRadio.checked)this.valueRadio.checked=!0;this.cbxAskValues.status=!1;this.cbxValueRequired.status=!1;d.setStyle(this.attributeValueContainer,"display","none")}else this.cbxAskValues.status=!0,this.cbxValueRequired.status=!0,d.setStyle(this.attributeValueContainer,"display","inline-block");
if(this.cbxAskValues.status&&this.cbxAskValues.getValue()){d.setStyle(this.promptTable,"display","table");var c=this.fieldsSelect?this._getSelectedFilteringItem(this.fieldsSelect):null;c&&"none"!==a&&this.promptTB.set("value",(c.alias||c.name)+" "+b)}else d.setStyle(this.promptTable,"display","none");this._checkProceed()}})});