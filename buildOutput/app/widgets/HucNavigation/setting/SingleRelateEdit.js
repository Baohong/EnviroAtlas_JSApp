//>>built
require({cache:{"url:widgets/HucNavigation/setting/SingleRelateEdit.html":'\x3cdiv style\x3d"width:100%;"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"singleRelatesSection"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"relateChoiceArea" style\x3d"width:100%;"\x3e\r\n      \x3ctable class\x3d"input-table" style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3"\x3e\r\n              \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd style\x3d"width:100%;"\x3e\r\n                    \x3cdiv style\x3d"margin-bottom:10px;"\x3e${nls.choose}  ${nls.availableRelates}\x3c/div\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd style\x3d"width:100%;"\x3e\r\n                    \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd style\x3d"width:auto;vertical-align:top;"\x3e\r\n                            \x3cdiv class\x3d"relate-table" style\x3d"width:100%;" data-dojo-attach-point\x3d"relateChoiceTable" data-dojo-type\x3d"jimu/dijit/SimpleTable"\r\n                              data-dojo-props\x3d"_rowHeight:40,autoHeight:true,selectable:true,fields:[{name:\'name\',title:\'${nls.availableRelates}\',type:\'text\',editable:false}, {name:\'id\',type:\'text\',hidden:true}]"\x3e\x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3ctable class\x3d"input-table" style\x3d"width:100%;margin-top:15px;" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                  \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd style\x3d"width:115px;text-align:left;"\x3e\r\n                          \x3cspan\x3e${nls.relateAlias}\x3c/span\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd style\x3d"width:auto;"\x3e\r\n                          \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-point\x3d"relateAlias" style\x3d"width:100%;" placeholder\x3d"Name for the relate" /\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd style\x3d"width:50%;" /\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3ctable style\x3d"width:100%;margin-top:15px;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd style\x3d"width:171px;vertical-align:top;"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:10px;"\x3e${nls.availableFields}\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"allFieldsTableDiv" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd style\x3d"width:75px;vertical-align:middle;padding-left:10px;padding-right:10px;"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"includeButtonDiv"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"includeAllButtonDiv"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd style\x3d"width:auto;vertical-align:top;"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:10px;"\x3e${nls.includedFields}\x3c/div\x3e\r\n            \x3cdiv style\x3d"width:100%;" class\x3d"searchLayerFieldsTable" data-dojo-attach-point\x3d"displayFieldsTableDiv"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/on dojo/Deferred dojo/json dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Tooltip dojo/text!./SingleRelateEdit.html dijit/form/TextBox ./IncludeAllButton ./IncludeButton ./SimpleTable ./LayerFieldChooser jimu/dijit/SimpleTable ./FieldFormatEdit jimu/dijit/Popup dojo/keys".split(" "),function(l,c,g,f,y,e,z,A,m,n,p,h,q,B,r,t,u,v,C,w,x,k){return l([m,n,p],{baseClass:"widget-esearch-singlerelate-setting",
templateString:q,nls:null,config:null,searchSetting:null,layerInfoCache:null,_layerInfo:null,layerURL:null,tr:null,selectedId:null,allFields:!1,postCreate:function(){this.inherited(arguments);this.allFieldsTable=new v({},this.allFieldsTableDiv);this.includeButton=new t({nls:this.nls},this.includeButtonDiv);this.includeAllButton=new r({nls:this.nls},this.includeAllButtonDiv);this.displayFieldsTable=new u({_rowHeight:40,autoHeight:!0,selectable:!0,fields:[{name:"name",title:this.nls.name,type:"text",
editable:!1,unique:!0,width:"25%"},{name:"alias",title:this.nls.alias,type:"text",editable:!0,width:"30%"},{name:"actions",width:"85px",title:this.nls.actions,type:"actions",actions:["up","down","edit","delete"]},{name:"isdate",type:"text",hidden:!0},{name:"isnumber",type:"text",hidden:!0},{name:"useutc",type:"text",hidden:!0},{name:"dateformat",type:"text",hidden:!0},{name:"numberformat",type:"text",hidden:!0},{name:"currencyformat",type:"text",hidden:!0}]},this.displayFieldsTableDiv);this.displayFieldsTable.startup();
f.addClass(this.displayFieldsTable.domNode,"searchLayerFieldsTable");this.setConfig(this.config);this._bindEvents();this._initTables()},setConfig:function(a){if(a)if(this.config=a,this.resetAll(),this.relateAlias.set("value",c.trim(this.config.label||"")),this.config.fields&&!this.config.fields.all&&this._addDisplayFields(this.config.fields.field),this.config.hasOwnProperty("id"))this.selectedId=this.config.id,this.allFieldsTable.refresh(this._getServiceUrlByLayerUrl(this.layerURL)+"/"+this.config.id).then(c.hitch(this,
function(){this.layerURL&&this.includeAllButton.enable();f.setStyle(this.relateChoiceArea,"display","none");this.config.fields.all&&(this.allFields=!0,this.onIncludeAllClick())}));else{var b;g.map(this.layerInfoCache[this.layerURL].relationships,c.hitch(this,function(a){b={name:a&&a.name||"",id:a.id.toString()};this.relateChoiceTable.addRow(b)}));f.setStyle(this.relateChoiceArea,"display","block")}},getConfig:function(){if(!this.validate(!1))return!1;var a={label:c.trim(this.relateAlias.get("value")),
id:parseInt(this.selectedId),fields:{all:!1,field:[]}};if(this.allFields)a.fields.all=!0;else{var b=this.displayFieldsTable.getData(),d,b=g.map(b,c.hitch(this,function(a){d={name:a.name,alias:a.alias};a.dateformat&&(d.dateformat=a.dateformat);a.useutc&&(d.useutc=!0);a.numberformat&&(d.numberformat=a.numberformat);a.currencyformat&&(d.currencyformat=a.currencyformat);a.isnumber&&(d.isnumber=!0);a.isdate&&(d.isdate=!0);return d}));a.fields.field=b}return this.config=a},_bindEvents:function(){this.own(e(this.includeButton,
"Click",c.hitch(this,this.onIncludeClick)));this.own(e(this.includeAllButton,"Click",c.hitch(this,this.onIncludeAllClick)))},_initTables:function(){this.own(e(this.allFieldsTable,"row-select",c.hitch(this,function(){this.includeButton.enable()})));this.own(e(this.allFieldsTable,"rows-clear",c.hitch(this,function(){this.includeButton.disable();this.includeAllButton.disable()})));this.own(e(this.allFieldsTable,"row-dblclick",c.hitch(this,function(){this.includeButton.enable();this.includeButton.onClick()})));
this.own(e(this.displayFieldsTable,"actions-edit",c.hitch(this,function(a){a.fieldInfo&&this._openFieldEdit(this.nls.edit+": "+a.fieldInfo.name,a)})));this.own(e(this.relateChoiceTable,"row-select",c.hitch(this,function(a){a=this.relateChoiceTable.getRowData(a);this.selectedId=a.id;this.relateAlias.set("value",c.trim(a.name||""));this.displayFieldsTable.clear();this.allFieldsTable.refresh(this._getServiceUrlByLayerUrl(this.layerURL)+"/"+a.id);this.includeAllButton.enable()})))},onIncludeClick:function(){var a=
this.allFieldsTable.getSelectedRow();a&&this._createDisplayField(a.fieldInfo)},onIncludeAllClick:function(){for(var a=this.allFieldsTable.getRows(),b=0,b=0;b<a.length;b++)this._createDisplayField(a[b].fieldInfo)},_addDisplayFields:function(a){for(var b=0,b=0;b<a.length;b++)this._createDisplayField(a[b])},_isNumberType:function(a){return 0<=g.indexOf(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a)},_openFieldEdit:function(a,b){this.fieldformatedit=
new w({nls:this.nls,tr:b,isRelate:!0});this.fieldformatedit.setConfig(b.fieldInfo||{});this.popup=new x({titleLabel:a,autoHeight:!0,content:this.fieldformatedit,container:"main-page",width:660,buttons:[{label:this.nls.ok,key:k.ENTER,onClick:c.hitch(this,"_onFieldEditOk")},{label:this.nls.cancel,key:k.ESCAPE}],onClose:c.hitch(this,"_onFieldEditClose")});f.addClass(this.popup.domNode,"widget-setting-popup");this.fieldformatedit.startup()},_onFieldEditOk:function(){var a={},b=this.fieldformatedit.getConfig();
b.dateformat&&(a.dateformat=b.dateformat);a.useutc=b.useutc?!0:!1;b.dateformat&&(a.dateformat=b.dateformat);b.numberformat&&(a.numberformat=b.numberformat);b.currencyformat&&(a.currencyformat=b.currencyformat);a!=={}&&(this.allFields=!1);this.displayFieldsTable.editRow(this.fieldformatedit.tr,a);this.popup.close()},_onFieldEditClose:function(){this.popup=this.fieldformatedit=null},_createDisplayField:function(a){var b=this._isNumberType(a.type)||a.isnumber,b={name:a.name,alias:a.alias||a.name,isnumber:b,
isdate:"esriFieldTypeDate"===a.type||a.isdate};if(a.hasOwnProperty("visible")&&!1===a.visible)return!1;a.dateformat&&(b.dateformat=a.dateformat);a.numberformat&&(b.numberformat=a.numberformat);a.currencyformat&&(b.currencyformat=a.currencyformat);a.useutc&&(b.useutc=a.useutc);this.displayFieldsTable.addRow(b).tr.fieldInfo=a},_getServiceUrlByLayerUrl:function(a){var b=a.lastIndexOf("/");return a.slice(0,b)},resetAll:function(){this.relateAlias.set("value","")},validate:function(a){return""===c.trim(this.relateAlias.get("value"))?
(a&&this._showTooltip(this.relateAlias.domNode,"Please input value."),!1):!0},_showTooltip:function(a,b,c){this._scrollToDom(a);h.show(b,a);setTimeout(function(){h.hide(a)},c?c:2E3)},_scrollToDom:function(a){var b=this.searchSetting.domNode.parentNode,c=f.position(b).y;a=f.position(a).y;b.scrollTop=a-c}})});