//>>built
define("dojo/_base/declare jimu/dijit/SimpleTable dojo/_base/lang dojo/_base/html dojo/_base/array dojo/Deferred esri/request".split(" "),function(e,f,c,g,d,h,k){return e([f],{declaredClass:"jimu.dijit.LayerFieldChooser",_def:null,_layerInfo:null,url:null,fields:[{name:"name",title:"Name",type:"text",editable:!1}],selectable:!0,fieldType:null,postCreate:function(){this.inherited(arguments);g.addClass(this.domNode,"jimu-layer-field-chooser");this.url="string"===typeof this.url?c.trim(this.url):null;
this.refresh(this.url)},refresh:function(a){this.url=a=c.trim(a||"");this._layerInfo=null;this.clear();return this._requestLayerInfo(a)},setFieldItems:function(a){a=d.filter(a,function(a){return"esriFieldTypeOID"!==a.type&&"esriFieldTypeGeometry"!==a.type});this._addFieldItems(a);return c.clone(a)},onRefreshed:function(a){},getLayerInfo:function(){return this._layerInfo},_requestLayerInfo:function(a){if(a){var b=new h;this._def&&this._def.cancel();this._def=k({url:a,content:{f:"json"},handleAs:"json",
callbackParamName:"callback",timeout:2E4},{useProxy:!1});this._def.then(c.hitch(this,function(a){this._layerInfo=a;var c=[];a&&a.fields&&(0<a.fields.length&&(c=this.setFieldItems(a.fields)),this.onRefreshed(a));b.resolve(c)}),c.hitch(this,function(a){this._layerInfo=null;console.error("request layer info failed",a);b.resolve(a)}));return b}},_addFieldItems:function(a){var b=a.length;if(a&&void 0!==b){a=c.clone(a);for(var d=0;d<b;d++)this._createFieldItem(a[d])}},_createFieldItem:function(a){if("number"===
this.fieldType&&!this._isNumberType(a.type)||"string"===this.fieldType&&!this._isStringType(a.type))return!1;var b=this.addRow({name:a.name||a.alias});b.success&&(b.tr.fieldInfo=a);return b.success},_isNumberType:function(a){return 0<=d.indexOf(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a)},_isStringType:function(a){return 0<=d.indexOf(["esriFieldTypeString"],a)}})});