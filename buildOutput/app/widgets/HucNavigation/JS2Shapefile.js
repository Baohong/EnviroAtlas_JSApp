//>>built
define(["dojo","dijit","dojox"],function(mb,nb,ob){(function(ha,l){"object"===typeof window&&(ha.JS2Shapefile=l())})(this,function(){"".lpad||(String.prototype.lpad=function(a,c){for(var g=this;g.length<c;)g=a+g;return g});"".rpad||(String.prototype.rpad=function(a,c){for(var g=this;g.length<c;)g+=a;return g});Array.indexOf||(Array.prototype.indexOf=function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return c;return-1});var ha={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,
15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,
99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,127:127,1027:129,8225:135,1046:198,8222:132,1047:199,1168:165,1048:200,1113:154,1049:201,1045:197,1050:202,1028:170,160:160,1040:192,1051:203,164:164,166:166,167:167,169:169,171:171,172:172,173:173,174:174,1053:205,176:176,177:177,1114:156,181:181,182:182,183:183,8221:148,187:187,
1029:189,1056:208,1057:209,1058:210,8364:136,1112:188,1115:158,1059:211,1060:212,1030:178,1061:213,1062:214,1063:215,1116:157,1064:216,1065:217,1031:175,1066:218,1067:219,1068:220,1069:221,1070:222,1032:163,8226:149,1071:223,1072:224,8482:153,1073:225,8240:137,1118:162,1074:226,1110:179,8230:133,1075:227,1033:138,1076:228,1077:229,8211:150,1078:230,1119:159,1079:231,1042:194,1080:232,1034:140,1025:168,1081:233,1082:234,8212:151,1083:235,1169:180,1084:236,1052:204,1085:237,1035:142,1086:238,1087:239,
1088:240,1089:241,1090:242,1036:141,1041:193,1091:243,1092:244,8224:134,1093:245,8470:185,1094:246,1054:206,1095:247,1096:248,8249:139,1097:249,1098:250,1044:196,1099:251,1111:191,1055:207,1100:252,1038:161,8220:147,1101:253,8250:155,1102:254,8216:145,1103:255,1043:195,1105:184,1039:143,1026:128,1106:144,8218:130,1107:131,8217:146,1108:186,1109:190},l=String.fromCharCode,S={},ia={POINT:1,POLYLINE:3,POLYGON:5},ja,wa,K=function(a,c){var g,xa,F,f={};if("undefined"===typeof a&&"POINT"!==a&&"POLYLINE"!==
a&&"POLYGON"!==a)return{successful:!1,message:"Unknown or unspecified shapefile type requested"};if(0===c.length)return{successful:!1,message:"No graphics of type "+a+" have been added!"};var G;a:{b:{var K=c.length,ya=100;switch(a){case "POINT":for(var za=28,L=1;L<K+1;L++)ya+=za;break;case "POLYLINE":case "POLYGON":for(L=1;L<K+1;L++){var ka=c[L-1],S=0,la;"POLYLINE"==a?la=ka.geometry.paths.length:"POLYGON"==a&&(la=ka.geometry.rings.length);for(var ma=0;ma<la;ma++)S+=("POLYLINE"===a?ka.geometry.paths[ma]:
ka.geometry.rings[ma]).length;za=52+4*la+16*S;ya+=za}break;default:g=!1;F=xa=void 0;break b}g=!0;xa=ya;F=100+8*K}if(!1===g)G=void 0;else{var Sa=xa,Ta=F,T=new ArrayBuffer(Sa),B=new DataView(T),na=new ArrayBuffer(Ta),C=new DataView(na);B.setInt32(0,9994);C.setInt32(0,9994);B.setInt32(28,1E3,!0);C.setInt32(28,1E3,!0);B.setInt32(32,ia[a],!0);C.setInt32(32,ia[a],!0);var M=Number.MAX_VALUE,N=Number.MAX_VALUE,O=-Number.MAX_VALUE,P=-Number.MAX_VALUE,Ua=c.length,H=100,oa=100,t,D,U;switch(a){case "POINT":U=
28;for(t=1;t<Ua+1;t++){D=c[t-1];var V=D.geometry.x,W=D.geometry.y;V<M&&(M=V);V>O&&(O=V);W<N&&(N=W);W>P&&(P=W);var X=new DataView(T,H);X.setInt32(0,t);X.setInt32(4,10);X.setInt32(8,ia[a],!0);X.setFloat64(12,V,!0);X.setFloat64(20,W,!0);var Va=new DataView(na,oa);Va.setInt32(0,H/2);Va.setInt32(4,10);oa+=8;H+=U}break;case "POLYLINE":case "POLYGON":for(t=1;t<Ua+1;t++){D=c[t-1];var Y=Number.MAX_VALUE,Z=Number.MAX_VALUE,aa=-Number.MAX_VALUE,ba=-Number.MAX_VALUE,ca;"POLYLINE"==a?ca=D.geometry.paths.length:
"POLYGON"==a&&(ca=D.geometry.rings.length);for(var Aa=[],pa=[],w=0;w<ca;w++){var Wa="POLYLINE"===a?D.geometry.paths[w]:D.geometry.rings[w],ib=Wa.length;Aa.push(pa.length);for(var x=0;x<ib;x++)pa.push(Wa[x])}var Ba=pa.length,Xa=52+4*ca;U=Xa+16*Ba;for(var Ya=U-8,Za=new DataView(T,H+Xa),x=0;x<Ba;x+=1){var u=pa[x];Za.setFloat64(16*x,u[0],!0);Za.setFloat64(16*x+8,u[1],!0);u[0]<Y&&(Y=u[0]);u[0]>aa&&(aa=u[0]);u[1]<Z&&(Z=u[1]);u[1]>ba&&(ba=u[1])}var v=new DataView(T,H);v.setInt32(0,t);v.setInt32(4,Ya/2);
v.setInt32(8,ia[a],!0);v.setFloat64(12,Y,!0);v.setFloat64(20,Z,!0);v.setFloat64(28,aa,!0);v.setFloat64(36,ba,!0);v.setInt32(44,ca,!0);v.setInt32(48,Ba,!0);for(w=0;w<Aa.length;w++)v.setInt32(52+4*w,Aa[w],!0);var $a=new DataView(na,oa);$a.setInt32(0,H/2);$a.setInt32(4,Ya/2);aa>O&&(O=aa);Y<M&&(M=Y);ba>P&&(P=ba);Z<N&&(N=Z);oa+=8;H+=U}break;default:G={successful:!1,message:"unknown shape type specified"};break a}B.setFloat64(36,M,!0);B.setFloat64(44,N,!0);B.setFloat64(52,O,!0);B.setFloat64(60,P,!0);C.setFloat64(36,
M,!0);C.setFloat64(44,N,!0);C.setFloat64(52,O,!0);C.setFloat64(60,P,!0);B.setInt32(24,Sa/2);C.setInt32(24,Ta/2);G={successful:!0,shape:T,shx:na}}}for(var h={},Ca=0;Ca<c.length;Ca++){var qa=c[Ca];if(qa.attributes)for(var y in qa.attributes)if(qa.attributes.hasOwnProperty(y)){var n=qa.attributes[y];if(h.hasOwnProperty(y))h[y].length<n.toString().length&&(h[y].length=n.toString().length);else switch(typeof n){case "number":if(parseInt(n)===n)h[y]={type:"N",length:n.toString().length};else if(parseFloat(n)===
n){var jb=n.toString().length-(n.toString().split(".")[0].length+1);h[y]={type:"N",length:n.toString().length,scale:jb}}break;case "boolean":h[y]={type:"L"};break;case "string":h[y]={type:"C",length:n.length}}}}var e=[],z;for(z in h)if(h.hasOwnProperty(z)){var Da={name:z,type:h[z].type,length:h[z].length};h[z].hasOwnProperty("length")&&(Da.length=h[z].length);h[z].hasOwnProperty("scale")&&(Da.scale=h[z].scale);e.push(Da)}0===e.length&&e.push({name:"ID_AUTO",type:"C",length:"18"});for(var Ea=c.length,
Fa=e.length,ab=32*Fa+1,Ga=ab+31+1,da=1,d=0;d<Fa;d++){var A=e[d].type||"C",b;switch(A){case "L":b=1;break;case "D":b=8;break;case "N":b=e[d].length&&19>e[d].length?e[d].length:18;break;case "C":b=e[d].length&&254>e[d].length?e[d].length:254}da+=parseInt(b)}for(var bb=da*Ea+1,ra=new ArrayBuffer(Ga+bb),ea=new DataView(ra,32),cb=[],da=1,d=0;d<Fa;d++){var sa=e[d].name.slice(0,10);-1==cb.indexOf(sa)&&cb.push(sa);for(var ta=0;ta<sa.length;ta++)ea.setInt8(32*d+ta,sa.charCodeAt(ta));A=e[d].type||"C";"L"==
A?b=1:"D"==A?b=8:"N"==A?b=e[d].length&&19>e[d].length?e[d].length:18:"C"==A?b=e[d].length&&254>e[d].length?e[d].length:254:(A="C",b=254);ea.setInt8(32*d+11,A.charCodeAt(0));ea.setInt8(32*d+16,b);"N"==A&&ea.setInt8(32*d+17,e[d].scale||0);e[d].length=parseInt(b);da+=parseInt(b)}ea.setInt8(ab-1,13);var E=new DataView(ra);E.setUint8(0,3);var Ha=new Date;E.setUint8(1,Ha.getFullYear()-1900);E.setUint8(2,Ha.getMonth());E.setUint8(3,Ha.getDate());E.setUint32(4,Ea,!0);E.setUint16(8,Ga,!0);E.setUint16(10,da,
!0);"Win1251"==ja&&E.setUint16(29,87,!0);for(var I=new DataView(ra,Ga),p=0,Q=0;Q<Ea;Q++){var Ia=c[Q].attributes||{};I.setUint8(p,32);for(var p=p+1,Ja=0;Ja<e.length;Ja++){var Ka=e[Ja],La=Ka.name,fa=Ka.type||"C";b=parseInt(Ka.length)||0;var m;switch(ja){case "UTF8":for(var Ma,Na=Ia[La]||Q.toString(),ua=[],ga=0,db=Na.length,R=void 0,Oa=void 0;ga<db;)R=Na.charCodeAt(ga++),55296<=R&&56319>=R&&ga<db?(Oa=Na.charCodeAt(ga++),56320==(Oa&64512)?ua.push(((R&1023)<<10)+(Oa&1023)+65536):(ua.push(R),ga--)):ua.push(R);
Ma=ua;for(var kb=Ma.length,eb=-1,fb=void 0,Pa="";++eb<kb;){var fb=Ma[eb],lb=Pa,Qa;var k=fb;if(0===(k&4294967168))Qa=l(k);else{var J="";if(0===(k&4294965248))J=l(k>>6&31|192);else if(0===(k&4294901760)){if(55296<=k&&57343>=k)throw Error("Lone surrogate U+"+k.toString(16).toUpperCase()+" is not a scalar value");J=l(k>>12&15|224);J+=l(k>>6&63|128)}else 0===(k&4292870144)&&(J=l(k>>18&7|240),J+=l(k>>12&63|128),J+=l(k>>6&63|128));Qa=J+=l(k&63|128)}Pa=lb+Qa}m=Pa;break;case "Win1251":for(var Ra=Ia[La]||Q.toString(),
gb=[],va=0;va<Ra.length;va++){var hb=Ra.charCodeAt(va);if(!(hb in ha))throw"Character "+Ra.charAt(va)+" isn't supported by win1251!";gb.push(String.fromCharCode(ha[hb]))}m=gb.join("");break;default:m=Ia[La]||Q.toString()}if("L"==fa)b=1,m?I.setUint8(p,84):I.setUint8(p,70),p+=1;else if("D"==fa){b=8;var q=m.toString();q.length!=b&&(q="".lpad(" ",8));for(var r=0;r<b;r++)I.setUint8(p,q.charCodeAt(r)),p+=1}else if("N"==fa){if(q=m.toString(),0!==b)for(q.length<b?q=q.lpad(" ",b):q.length>b&&(q=q.substr(0,
18)),r=0;r<b;r++)I.setUint8(p,q.charCodeAt(r)),p+=1}else if(("C"===fa||""===fa)&&0!==b)for("string"!==typeof m&&(m=m.toString()),m.length<b&&(m=m.rpad(" ",b)),r=0;r<b;r++)I.setUint8(p,m.charCodeAt(r)),p+=1}}I.setUint8(bb-1,26);G.dbf=ra;f.shp={};f.shp.blob=new Blob([G.shape],{type:"application/octet-stream"});f.shp.name=a+"_Huc_Navigation.shp";f.shx={};f.shx.blob=new Blob([G.shx],{type:"application/octet-stream"});f.shx.name=a+"_Huc_Navigation.shx";f.dbf={};f.dbf.blob=new Blob([G.dbf],{type:"application/octet-stream"});
f.dbf.name=a+"_Huc_Navigation.dbf";"UTF8"==ja&&(f.cpg={},f.cpg.blob=new Blob(["65001"],{type:"plain/text"}),f.cpg.name=a+"_Huc_Navigation.cpg");wa&&(f.prj={},f.prj.blob=new Blob([wa],{type:"plain/text"}),f.prj.name=a+"_Huc_Navigation.prj");return{successful:!0,shapefile:f}};S.createShapeFiles=function(a,c,g){ja=c;wa=g;var l=[];g=[];c=[];for(var F=0;F<a.length;F++){var f=a[F];switch(f.geometry.type){case "point":l.push(f);break;case "polyline":g.push(f);break;case "polygon":c.push(f);break;default:throw Error("Unknown geometry type");
}}a=K("POINT",l);g=K("POLYLINE",g);c=K("POLYGON",c);return{pointShapefile:a,polylineShapefile:g,polygonShapefile:c}};return S})});