//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/on dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/TabContainer jimu/utils dijit/form/Select jimu/dijit/CheckBox jimu/dijit/SimpleTable jimu/dijit/Message".split(" "),function(n,c,d,f,l,g,p,q,r,e,m,u,v,t){return n([q,p],{baseClass:"jimu-widget-draw-setting",distanceUnits:null,areaUnits:null,_disabledClass:"jimu-state-disabled",localStorageKeyMessage:function(){new t({message:this.nls.localStorageKeyInfo})},
postMixInProperties:function(){this.inherited(arguments);this.distanceUnits=[{value:"KILOMETERS",label:this.nls.kilometers,abbr:this.nls.kilometersAbbreviation||"km",conversion:e.localizeNumber(.001,{places:3})},{value:"MILES",label:this.nls.miles,abbr:this.nls.milesAbbreviation||"mi",conversion:e.localizeNumber(6.21E-4,{places:6})},{value:"METERS",label:this.nls.meters,abbr:this.nls.metersAbbreviation||"m",conversion:e.localizeNumber(1)},{value:"NAUTICAL_MILES",label:this.nls.nauticals,abbr:this.nls.nauticalsAbbreviation||
"nm",conversion:e.localizeNumber(5.3957E-4,{places:7})},{value:"FEET",label:this.nls.feet,abbr:this.nls.feetAbbreviation||"ft",conversion:e.localizeNumber(3.2808,{places:4})},{value:"YARDS",label:this.nls.yards,abbr:this.nls.yardsAbbreviation||"yd",conversion:e.localizeNumber(1.0936133,{places:7})}];this.areaUnits=[{value:"SQUARE_KILOMETERS",label:this.nls.squareKilometers,abbr:this.nls.squareKilometersAbbreviation||"sq km",conversion:e.localizeNumber(1E-6,{places:6})},{value:"SQUARE_MILES",label:this.nls.squareMiles,
abbr:this.nls.squareMilesAbbreviation||"sq mi",conversion:e.localizeNumber(3.861021,{places:6})+"e-7"},{value:"ACRES",label:this.nls.acres,abbr:this.nls.acresAbbreviation||"ac",conversion:e.localizeNumber(2.4710538147E-4,{places:14})},{value:"HECTARES",label:this.nls.hectares,abbr:this.nls.hectaresAbbreviation||"ha",conversion:e.localizeNumber(1E-4,{places:4})},{value:"SQUARE_METERS",label:this.nls.squareMeters,abbr:this.nls.squareMetersAbbreviation||"sq m",conversion:e.localizeNumber(1)},{value:"SQUARE_FEET",
label:this.nls.squareFeet,abbr:this.nls.squareFeetAbbreviation||"sq ft",conversion:e.localizeNumber(10.763910417,{places:9})},{value:"SQUARE_YARDS",label:this.nls.squareYards,abbr:this.nls.squareYardsAbbreviation||"sq yd",conversion:e.localizeNumber(1.19599005,{places:8})}]},postCreate:function(){this.inherited(arguments);this.own(g(this.btnAddDistance,"click",c.hitch(this,this._addDistance)));this.own(g(this.btnAddArea,"click",c.hitch(this,this._addArea)));this.own(g(this.btnAddFontFamily,"click",
c.hitch(this,this._addFontFamily)));this.own(g(this.distanceTable,"row-delete",c.hitch(this,function(a){a.select&&(a.select.destroy(),delete a.select);this._resetDistanceSelectOptions();this._checkStatusForBtnAddDistance()})));this.own(g(this.areaTable,"row-delete",c.hitch(this,function(a){a.select&&(a.select.destroy(),delete a.select);this._resetAreaSelectOptions();this._checkStatusForBtnAddArea()})));this.setConfig(this.config)},startup:function(){this.inherited(arguments);this.tabContainer=new r({tabs:[{title:this.nls.distance,
content:this.distanceTabNode},{title:this.nls.area,content:this.areaTabNode}],isNested:!0},this.content);this.tabContainer.startup()},setConfig:function(a){a.isOperationalLayer=!!a.isOperationalLayer;this.config=a;this._setDistanceTable(this.config.distanceUnits);this._setAreaTable(this.config.areaUnits);this._setTextPlusFontFamilyTable(this.config);this.exportFileNameInput.value=a.exportFileName?a.exportFileName:this.nls.exportFileName;this.confirmOnDeleteInput.checked=a.confirmOnDelete?!0:!1;this.listShowUpAndDownButtons.checked=
a.listShowUpAndDownButtons?!0:!1;this.allowLocalStorageInput.checked=a.allowLocalStorage?!0:!1;this.localStorageKeyInput.value=a.localStorageKey?a.localStorageKey:"";this._setTextPlusFontFamilyTable(a);this.measureEnabledByDefaultInput.checked=a.measureEnabledByDefault;this.measurePolylineLabelInput.value=a.measurePolylineLabel&&""!=a.measurePolylineLabel.trim()?a.measurePolylineLabel.trim():"{{length}} {{lengthUnit}}";this.measurePolygonLabelInput.value=a.measurePolygonLabel&&""!=a.measurePolygonLabel.trim()?
a.measurePolygonLabel.trim():"{{area}} {{areaUnit}}    {{length}} {{lengthUnit}}"},_setTextPlusFontFamilyTable:function(a){a=a.drawPlus&&a.drawPlus.fontFamilies&&0<a.drawPlus.fontFamilies.length?a.drawPlus.fontFamilies:[{label:"Arial",value:"Arial"},{label:"Helvetica",value:"Helvetica"},{label:"Times New Roman",value:"Times New Roman"},{label:"Courier New",value:"Courier New"}];this.textPlusFontFamilyTable.clear();for(var b in a)this.textPlusFontFamilyTable.addRow(a[b])},_setDistanceTable:function(a){this.distanceTable.clear();
d.forEach(a,c.hitch(this,function(a){var b=this._getDistanceUnitInfo(a.unit);b&&(b.abbr=a.abbr,this._addDistanceUnitRow(b))}))},_setAreaTable:function(a){this.areaTable.clear();d.forEach(a,c.hitch(this,function(a){var b=this._getAreaUnitInfo(a.unit);b&&(b.abbr=a.abbr,this._addAreaUnitRow(b))}))},getConfig:function(){var a={distanceUnits:[],areaUnits:[],isOperationalLayer:!1};a.distanceUnits=this._getDistanceConfig();a.areaUnits=this._getAreaConfig();a.exportFileName=""!=this.exportFileNameInput.value.trim()?
this.exportFileNameInput.value.trim():this.nls.exportFileName;a.confirmOnDelete=this.confirmOnDeleteInput.checked;a.listShowUpAndDownButtons=this.listShowUpAndDownButtons.checked;a.allowLocalStorage=this.allowLocalStorageInput.checked;var b=this.localStorageKeyInput.value.trim();a.localStorageKey=""==b?!1:b;a.drawPlus||(a.drawPlus={});b=d.map(this.textPlusFontFamilyTable.getRows(),c.hitch(this,function(a){a=this.textPlusFontFamilyTable.getRowData(a);return{value:a.value,label:a.label}}));a.drawPlus.fontFamilies=
b;a.measureEnabledByDefault=this.measureEnabledByDefaultInput.checked;a.measurePolylineLabel=this.measurePolylineLabelInput.value&&""!=this.measurePolylineLabelInput.value.trim()?this.measurePolylineLabelInput.value:!1;a.measurePolygonLabel=this.measurePolygonLabelInput.value&&""!=this.measurePolygonLabelInput.value.trim()?this.measurePolygonLabelInput.value:!1;return a},_getDistanceConfig:function(){var a=[],a=this.distanceTable.getRows();return a=d.map(a,c.hitch(this,function(a){var b=this.distanceTable.getRowData(a);
return{unit:a.select.get("value"),abbr:b.abbr}}))},_getAreaConfig:function(){var a=[],a=this.areaTable.getRows();return a=d.map(a,c.hitch(this,function(a){var b=this.areaTable.getRowData(a);return{unit:a.select.get("value"),abbr:b.abbr}}))},_getAllDistanceUnitValues:function(){return d.map(this.distanceUnits,c.hitch(this,function(a){return a.value}))},_getUsedDistanceUnitValues:function(){var a=this.distanceTable.getRows();return d.map(a,c.hitch(this,function(a){return a.select.get("value")}))},_getNotUsedDistanceUnitValues:function(){var a=
this._getAllDistanceUnitValues(),b=this._getUsedDistanceUnitValues();return d.filter(a,c.hitch(this,function(a){return 0>d.indexOf(b,a)}))},_getDistanceUnitInfo:function(a){var b=null,k=d.filter(this.distanceUnits,c.hitch(this,function(b){return b.value===a}));0<k.length&&(b=c.mixin({},k[0]));return b},_addFontFamily:function(){console.log("Add font family");var a={label:"New font family",value:"New font family"},b=this.textPlusFontFamilyTable.addRow(a);b&&this.textPlusFontFamilyTable.editRow(b.tr,
a)},_addDistance:function(){var a=this._getNotUsedDistanceUnitValues();0!==a.length&&(a=this._getDistanceUnitInfo(a[0]),this._addDistanceUnitRow(a))},_checkStatusForBtnAddDistance:function(){0===this._getNotUsedDistanceUnitValues().length?(f.addClass(this.btnAddDistance,this._disabledClass),f.addClass(this.btnAddDistanceIcon,this._disabledClass)):(f.removeClass(this.btnAddDistance,this._disabledClass),f.removeClass(this.btnAddDistanceIcon,this._disabledClass))},_addDistanceUnitRow:function(a){var b=
this.distanceTable.addRow({abbr:a.abbr,conversion:a.conversion});if(b.success&&b.tr){var b=b.tr,d=l(".simple-table-cell",b)[0];f.setStyle(d,"verticalAlign","middle");var h=new m({style:"width:100%;height:18px;line-height:18px;"});h.placeAt(d);h.startup();h.addOption({value:a.value,label:a.label,selected:!0});this.own(g(h,"change",c.hitch(this,this._resetDistanceSelectOptions)));b.select=h}this._resetDistanceSelectOptions();this._checkStatusForBtnAddDistance()},_showCorrectDistanceInfoBySelectedOption:function(a){var b=
this._getDistanceUnitInfo(a.select.value);this.distanceTable.editRow(a,{abbr:b.abbr,conversion:b.conversion})},_resetDistanceSelectOptions:function(){var a=this.distanceTable.getRows(),b=d.map(a,c.hitch(this,function(a){return a.select})),k=this._getNotUsedDistanceUnitValues(),h=d.map(k,c.hitch(this,function(a){return this._getDistanceUnitInfo(a)}));d.forEach(b,c.hitch(this,function(b,k){var e=b.get("value"),f=d.filter(b.getOptions(),c.hitch(this,function(a){return a.value!==e}));b.removeOption(f);
d.forEach(h,c.hitch(this,function(a){b.addOption({value:a.value,label:a.label})}));b.set("value",e);this._showCorrectDistanceInfoBySelectedOption(a[k])}))},_getAllAreaUnitValues:function(){return d.map(this.areaUnits,c.hitch(this,function(a){return a.value}))},_getUsedAreaUnitValues:function(){var a=this.areaTable.getRows();return d.map(a,c.hitch(this,function(a){return a.select.get("value")}))},_getNotUsedAreaUnitValues:function(){var a=this._getAllAreaUnitValues(),b=this._getUsedAreaUnitValues();
return d.filter(a,c.hitch(this,function(a){return 0>d.indexOf(b,a)}))},_getAreaUnitInfo:function(a){var b=null,e=d.filter(this.areaUnits,c.hitch(this,function(b){return b.value===a}));0<e.length&&(b=c.mixin({},e[0]));return b},_addArea:function(){var a=this._getNotUsedAreaUnitValues();0!==a.length&&(a=this._getAreaUnitInfo(a[0]),this._addAreaUnitRow(a))},_checkStatusForBtnAddArea:function(){0===this._getNotUsedAreaUnitValues().length?(f.addClass(this.btnAddArea,this._disabledClass),f.addClass(this.btnAddAreaIcon,
this._disabledClass)):(f.removeClass(this.btnAddArea,this._disabledClass),f.removeClass(this.btnAddAreaIcon,this._disabledClass))},_addAreaUnitRow:function(a){var b=this.areaTable.addRow({abbr:a.abbr,conversion:a.conversion});if(b.success&&b.tr){var b=b.tr,d=l(".simple-table-cell",b)[0];f.setStyle(d,"verticalAlign","middle");var e=new m({style:"width:100%;height:18px;line-height:18px;"});e.placeAt(d);e.startup();e.addOption({value:a.value,label:a.label,selected:!0});this.own(g(e,"change",c.hitch(this,
this._resetAreaSelectOptions)));b.select=e}this._resetAreaSelectOptions();this._checkStatusForBtnAddArea()},_showCorrectAreaInfoBySelectedOption:function(a){var b=this._getAreaUnitInfo(a.select.value);this.areaTable.editRow(a,{abbr:b.abbr,conversion:b.conversion})},_resetAreaSelectOptions:function(){var a=this.areaTable.getRows(),b=d.map(a,c.hitch(this,function(a){return a.select})),e=this._getNotUsedAreaUnitValues(),f=d.map(e,c.hitch(this,function(a){return this._getAreaUnitInfo(a)}));d.forEach(b,
c.hitch(this,function(b,e){var g=b.get("value"),h=d.filter(b.getOptions(),c.hitch(this,function(a){return a.value!==g}));b.removeOption(h);d.forEach(f,c.hitch(this,function(a){b.addOption({value:a.value,label:a.label})}));b.set("value",g);this._showCorrectAreaInfoBySelectedOption(a[e])}))}})});