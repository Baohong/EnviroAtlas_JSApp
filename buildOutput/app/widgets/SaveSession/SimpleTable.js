//>>built
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query jimu/utils".split(" "),function(p,q,r,t,f,d,k,m,g,n){return p([q,r,t],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"tableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"\x3e\x3ccolgroup\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"\x3e\x3c/thead\x3e\x3ctbody class\x3d"simple-table-tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);this._initSelf()},
startup:function(){this.inherited(arguments);this._updateUI()},_initSelf:function(){this._initAttachPoints();this.own(n.bindClickAndDblclickEvents(this.table,f.hitch(this,function(a){if(a=n.getAncestorDom(a.target||a.srcElement,function(a){return d.hasClass(a,"simple-table-row")&&d.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),f.hitch(this,function(a){if(a=n.getAncestorDom(a.target||a.srcElement,function(a){return d.hasClass(a,"simple-table-row")&&d.hasClass(a,"not-empty")},
this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var a=Math.random().toString();this._name="jimu_table_"+a.slice(2,a.length);this.thead=g("thead",this.domNode)[0];this.tbody=g("tbody",this.domNode)[0];if(this.fields&&0<this.fields.length){var b=d.create("tr",{},this.thead);k.forEach(this.fields,f.hitch(this,function(a){var c="auto";"actions"===a.type&&(a.name="actions");a.hidden?c=1:void 0!==a.width&&null!==a.width?c=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+
20,c=a.width);d.create("col",{width:c},this.colgroup);c=d.create("th",{innerHTML:a.title,title:a.title},b);d.addClass(c,"simple-table-field");a.hidden&&d.addClass(c,"hidden-column");a["class"]&&d.addClass(c,a["class"]);d.addClass(c,a.name)}));d.empty(this.headDiv);a=f.clone(this.tableDiv);d.place(a,this.headDiv)}else this.fields=null},_initAttachPoints:function(){this.table=g("table",this.bodyDiv)[0];this.colgroup=g("colgroup",this.bodyDiv)[0];this.head=g("thead",this.bodyDiv)[0];this.tbody=g("tbody",
this.bodyDiv)[0]},clear:function(){var a=this._getNotEmptyRows();d.empty(this.tbody);k.forEach(a,f.hitch(this,function(a){this._onDeleteRow(a)}));this._updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&a&&0<a.length&&k.forEach(a,f.hitch(this,function(a){b.push(this.addRow(a,!0))}));this._updateUI();return b},addRow:function(a,b){this._rowIndex++;var c={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return c;
var e=k.filter(this.fields,f.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=k.filter(e,f.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<e.length)return c.errorCode=this.REPEATING_ERROR,c.errorMessage="repeating data",c.repeatFields=e,c;var h=d.create("tr",{"class":"simple-table-row not-empty"},this.tbody);d.setAttr(h,"rowId","row"+this._rowIndex);k.forEach(this.fields,f.hitch(this,function(b){var c=a[b.name],e=b.type,l=null;"actions"===
e?l=this._createActionsTd(h,b):("text"===e?l=this._createTextTd(h,b,c):"radio"===e?l=this._createRadioTd(h,b,c):"checkbox"===e?l=this._createCheckboxTd(h,b,c):"empty"===e?l=this._createEmptyTd(h,b):"extension"===e&&(l=this._createExtensionTd(h,b,c)),b.hidden&&d.addClass(l,"hidden-column"))}));h.item=a;b||this._updateUI();c.success=!0;c.tr=h;c.errorMessage=null;this._onAddRow(h);return c},deleteRow:function(a){a&&(d.destroy(a),this._updateUI(),this._onDeleteRow(a))},selectRow:function(a){this.selectable&&
(g(".simple-table-row",this.tbody).removeClass("jimu-state-active"),d.addClass(a,"jimu-state-active"),this._onSelectRow(a))},_updateUI:function(){this._updateRowClassName();this._updateHeight()},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();d.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=g("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=g("."+this._classRowUpDiv,a)[0])&&d.removeClass(a,
this._classJimuStateDisabled);(a=g("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=g("."+this._classRowDownDiv,a)[0])&&d.removeClass(a,this._classJimuStateDisabled);a=g("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);k.forEach(a,f.hitch(this,function(a,b){0===b%2?d.addClass(a,"odd"):d.addClass(a,"even")}));if(0<a.length){var b=a[0];d.addClass(b,this._classFirstSimpleTableRow);
(b=g("."+this._classRowUpDiv,b)[0])&&d.addClass(b,this._classJimuStateDisabled);a=a[a.length-1];d.addClass(a,this._classLastSimpleTableRow);(a=g("."+this._classRowDownDiv,a)[0])&&d.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,c){var d=null;return d=b.editable?this._createEditableTextTd(a,b,c):this._createNormalTextTd(a,b,c)},_createNormalTextTd:function(a,b,c){var e=d.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');
d.addClass(e,b.name);var h=g("div",e)[0];h.innerHTML=c||"";h.title=c||"";b["class"]&&d.addClass(e,b["class"]);d.place(e,a);return e},_createEditableTextTd:function(a,b,c){var e=d.toDom('\x3ctd class\x3d"editable-text-td '+b.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');d.addClass(e,"simple-table-cell");d.place(e,a);b["class"]&&d.addClass(e,b["class"]);var h=g("div",e)[0],l=g("input",e)[0];h.innerHTML=
c||"";""!==h.innerHTML&&(h.title=h.innerHTML);l.value=h.innerHTML;this.own(m(l,"keypress",f.hitch(this,function(a){a.keyCode===dojo.keys.ENTER&&l.blur()})));this.own(m(l,"blur",f.hitch(this,function(){l.value=f.trim(l.value);var c=h.innerHTML,e=l.value;""!==e?b.unique?0<this.getRowDataArrayByFieldValue(b.name,e,a).length?l.value=c:h.innerHTML=e:h.innerHTML=e:l.value=c;a.item[b.name]=h.innerHTML;d.setStyle(l,"display","none");d.setStyle(h,"display","block");this._onEditRow(a)})));return e},_createRadioTd:function(a,
b,c){var e=d.toDom('\x3ctd class\x3d"radio-td '+b.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');d.addClass(e,"simple-table-cell");d.place(e,a);b["class"]&&d.addClass(e,b["class"]);a=g("input",e)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===c;return e},_createCheckboxTd:function(a,b,c){var e=d.toDom('\x3ctd class\x3d"checkbox-td '+b.name+'"\x3e\x3cinput type\x3d"checkbox" /\x3e\x3c/td\x3e');d.addClass(e,"simple-table-cell");d.place(e,a);b["class"]&&
d.addClass(e,b["class"]);g("input",e)[0].checked=!0===c;return e},_createActionsTd:function(a,b){var c=d.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');d.addClass(c,"simple-table-cell");var e=g(".action-item-parent",c)[0];d.place(c,a);b["class"]&&d.addClass(c,b["class"]);k.forEach(b.actions,f.hitch(this,function(b){"up"===b?(b=d.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},e),
b.title=this.nls.moveUp,this.own(m(b,"click",f.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=g(".simple-table-row",this.tbody);var c=k.indexOf(b,a);0<c&&(b=b[c-1])&&(d.place(a,b,"before"),this._updateUI(),this.emit("row-up",a))}})))):"down"===b?(b=d.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},e),b.title=this.nls.moveDown,this.own(m(b,"click",f.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=g(".simple-table-row",
this.tbody);var c=k.indexOf(b,a);c<b.length-1&&(b=b[c+1])&&(d.place(a,b,"after"),this._updateUI(),this.emit("row-down",a))}})))):"load"===b?(b=d.create("div",{"class":"action-item jimu-float-leading row-load-div jimu-icon jimu-icon-load"},e),b.title="Load Map",this.own(m(b,"click",f.hitch(this,function(b){b.stopPropagation();this._onActionsLoad(a)})))):"download"===b?(b=d.create("div",{"class":"action-item jimu-float-leading row-load-div jimu-icon jimu-icon-download"},e),b.title="Download Map",this.own(m(b,
"click",f.hitch(this,function(b){b.stopPropagation();this._onActionsDownload(a)})))):"edit"===b?(b=d.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},e),b.title=this.nls.edit,this.own(m(b,"click",f.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===b&&(b=d.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},e),b.title=this.nls.deleteRow,this.own(m(b,"click",
f.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));b=this._calculateActionsWidth(b)+"px";d.setStyle(e,"width",b);return c},_calculateActionsWidth:function(a){return 30*k.map(a.actions,function(a){return"load"===a||"up"===a||"down"===a||"edit"===a||"delete"===a||"download"===a}).length},_createEmptyTd:function(a,b){a=d.create("td",{"class":b.name},a);d.addClass(a,"simple-table-cell");d.addClass(a,"empty-text-td");b["class"]&&d.addClass(a,b["class"]);return a},
_createExtensionTd:function(a,b,c){a=d.create("td",{"class":b.name},a);d.addClass(a,"simple-table-cell");d.addClass(a,"extension-td");b["class"]&&d.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c);return a},editRow:function(a,b){var c={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!d.isDescendant(a,this.tbody))return c;var e=f.mixin([],this.fields),e=
k.filter(e,f.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=k.filter(e,f.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,b[c.name],a).length}));if(0<e.length)return c.errorCode=this.REPEATING_ERROR,c.errorMessage="repeating data",c.repeatFields=e,c;var h=g(".simple-table-cell",a);k.forEach(this.fields,f.hitch(this,function(a,c){if(b.hasOwnProperty(a.name)){c=h[c];var d=b[a.name],e=a.type;"text"===e?a.editable?this._editEditableText(c,a,d):this._editNormalText(c,
a,d):"radio"===e?this._editRadio(c,a,d):"checkbox"===e?this._editCheckbox(c,a,d):"extension"===e&&this._editExtension(c,a,d)}}));c.success=!0;c.tr=a;c.errorMessage=null;this._onEditRow(a);return c},_editNormalText:function(a,b,c){a=g("div",a)[0];a.innerHTML=c||"";a.title=a.innerHTML},_editEditableText:function(a,b,c){b=g("div",a)[0];b.innerHTML=c||"";g("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,c){g("input",a)[0].checked=!0===c},_editCheckbox:function(a,b,c){g("input",a)[0].checked=
!0===c},_editExtension:function(a,b,c){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c)},_getAllRows:function(){return g(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return k.filter(a,f.hitch(this,function(a){return!d.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return k.filter(a,f.hitch(this,function(a){return d.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=
null,b=g(".simple-table-row",this.tbody),b=k.filter(b,f.hitch(this,function(a){return!d.hasClass(a,"empty")&&d.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=k.filter(b,f.hitch(this,function(b){return b!==a})));return k.map(b,f.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},
_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;k.forEach(this.fields,f.hitch(this,function(c){var d=c.type;if("actions"!==d){var h=c.name;b[h]=null;var f=g("."+h,a)[0];f&&("text"===d?(c=g("div",f)[0],b[h]=c.innerHTML):"radio"===d?(c=g("input",f)[0],b[h]=c.checked):"checkbox"===d?(c=g("input",f)[0],b[h]=c.checked):"extension"===d&&c.getValue&&"function"===typeof c.getValue&&(b[h]=c.getValue(f,c)))}}));return b},getRowDataArrayByFieldValue:function(a,b,c){var d=[];if(!this.fields||
!k.some(this.fields,f.hitch(this,function(b){return b.name===a})))return[];c=this.getData(c);return d=k.filter(c,f.hitch(this,function(c){return c[a]==b}))},getItems:function(){var a=[],a=[],a=this._getNotEmptyRows();return a=k.map(a,f.hitch(this,function(a){return a.item}))},_setEditModeOnRow:function(a){a=g(".simple-table-cell",a);k.forEach(a,f.hitch(this,function(a,c){d.hasClass(a,"actions")||this._setEditModeOnCell(a)}))},_setEditModeOnCell:function(a){var b=g("div",a)[0];a=g("input",a)[0];a.value=
b.innerHTML;d.setStyle(b,"display","none");d.setStyle(a,"display","inline");a.focus()},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",{element:a,item:a.item})},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a){this.emit("row-delete",{element:a,item:a.item})},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",
a)},_onActionsEdit:function(a){this.emit("actions-edit",a);this._setEditModeOnRow(a)},_onActionsLoad:function(a){this.emit("actions-load",{element:a,item:a.item})},_onActionsDownload:function(a){this.emit("actions-download",{element:a,item:a.item})},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})});