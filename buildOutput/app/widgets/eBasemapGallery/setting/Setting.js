//>>built
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/dom-style dojo/dom-attr dojo/query dojo/Deferred dojo/promise/all jimu/dijit/Message jimu/dijit/Popup jimu/dijit/CheckBox jimu/SpatialReference/wkidUtils jimu/dijit/LoadingShelter ./Edit ../utils".split(" "),function(n,p,q,e,r,c,m,h,x,y,f,z,A,B,t,C,u,v,w,k){return n([q,p],{baseClass:"jimu-widget-basemapgallery-setting",basemaps:[],edit:null,editTr:null,
popup:null,editIndex:null,spatialRef:null,startup:function(){this.inherited(arguments);this.config.basemapGallery||(this.config.basemapGallery={});this.setConfig(this.config)},isEmpty:function(a){return!(!a||"object"!=typeof a)&&!Object.keys(a).length},setConfig:function(a){setTimeout(function(){var a=dojo.query(".help-link");a[0].href="http://gis.calhouncounty.org/WAB/V2.5/widgets/eBasemapGallery/help/eBasemapGallery_Help.htm";c.setStyle(a[0],"display","block")},600);this.config=a;this.basemaps.length=
0;if(0===a.basemapGallery.basemaps.length){var b=new v;b.placeAt(this.baseMapsDiv);b.startup();k._loadPortalBaseMaps(this.appConfig.portalUrl,this.map.spatialReference).then(e.hitch(this,function(a){this.basemaps=a=r.filter(a,e.hitch(this,function(a){return!this.isEmpty(a)}));this.refreshMapGallary();b.destroy()}),function(){b.destroy()})}else{var l=a.basemapGallery.basemaps.length;a=a.basemapGallery.basemaps;for(var d=0;d<l;d++)this.basemaps.push({title:a[d].title,thumbnailUrl:a[d].thumbnailUrl,
layers:a[d].layers,spatialReference:a[d].spatialReference});this.refreshMapGallary()}},getConfig:function(){this.config.basemapGallery.basemaps=this.basemaps;return this.config},_findBaseMapByTitle:function(a){for(var b=0;b<this.basemaps.length;b++)if(this.basemaps[b].title===a)return b;return-1},onAddBaseMapClick:function(){this._openEdit(null,null)},refreshMapGallary:function(){this.clearBaseMapsDiv();this._createMapItems();return!0},_createMapItems:function(){for(var a=0;a<this.basemaps.length;a++)if(this.basemaps[a].title){var b=
this._createMapItem(this.basemaps[a]);c.place(b,this.baseMapsDiv)}},_createMapItem:function(a){var b=c.toDom("\x3cdiv class\x3d'map-item-div'\x3e\x3cdiv class\x3d'map-item-bg'\x3e\x3cdiv class\x3d'map-item-thumbnail'\x3e\x3c/div\x3e\x3cdiv class\x3d'map-item-delete-icon'\x3e\x3c/div\x3e\x3cdiv class\x3d'map-item-detail-icon'\x3e\x3c/div\x3e\x3cspan class\x3d'map-item-title'\x3e\x3c/span\x3e\x3c/div\x3e"),l=f(".map-item-bg",b)[0],d=f(".map-item-thumbnail",b)[0],h=f(".map-item-title",b)[0],g=f(".map-item-delete-icon",
b)[0];this.own(m(g,"click",e.hitch(this,this._onMapItemDeleteClick,b,a)));g=f(".map-item-detail-icon",b)[0];this.own(m(g,"click",e.hitch(this,this._onMapItemEditClick,b,a)));b.item=a;a.thumbnailUrl?g=0===a.thumbnailUrl.indexOf("http")?a.thumbnailUrl+k.getToken(this.appConfig.portalUrl):a.thumbnailUrl.startWith("/")||a.thumbnailUrl.startWith("data")?a.thumbnailUrl:this.folderUrl+a.thumbnailUrl:(a.thumbnailUrl=this.folderUrl+"images/default.jpg",g=a.thumbnailUrl);c.setStyle(d,"backgroundImage","url("+
g+")");h.innerHTML=a.title;h.title=a.title;u.isSameSR(this.map.spatialReference.wkid,a.spatialReference.wkid)||(c.setStyle(d,"border","1px solid red"),a=c.create("div",{"class":"map-item-warning-icon"},l),c.attr(a,"title",this.nls.invalidBasemapUrl2));return b},clearBaseMapsDiv:function(){for(var a=f(".map-item-div",this.domNode),b=0;b<a.length;b++)c.destroy(a[b])},_openEdit:function(a,b){a=new w({nls:this.nls,folderUrl:this.folderUrl,basemap:b,basemaps:this.basemaps,map:this.map,token:k.getToken(this.appConfig.portalUrl)});
this.popup=new t({titleLabel:b&&b.title||this.nls.addlayer,autoHeight:!0,content:a,container:"main-page",width:840,buttons:[{label:this.nls.ok,key:h.ENTER,disable:!0,onClick:e.hitch(a,a._onEditOk,this)},{label:this.nls.cancel,key:h.ESCAPE,onClose:e.hitch(a,a._onEditClose,this)}]});a.startup()},_onMapItemEditClick:function(a,b,c){this._openEdit(a,b);c.stopPropagation()},_onMapItemDeleteClick:function(a,b,e){c.destroy(a);a=this._findBaseMapByTitle(b.title);0<=a&&this.basemaps.splice(a,1);e.stopPropagation()}})});